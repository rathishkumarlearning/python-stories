<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Python Adventures â€” Learn Python Through Stories</title>
<meta name="description" content="A magical storybook where kids learn Python through interactive stories with 3D animations">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0a2e;--bg2:#12123a;--gold:#fbbf24;--purple:#8b5cf6;--green:#10b981;
  --pink:#ec4899;--cyan:#06b6d4;--red:#ef4444;--orange:#f97316;
  --text:#e2e8f0;--text-dim:#94a3b8;--text-bright:#f8fafc;
}
html{scroll-behavior:smooth}
body{font-family:'Fredoka',sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;min-height:100vh}
::selection{background:var(--purple);color:white}
::-webkit-scrollbar{width:8px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--purple);border-radius:4px}

/* ===== THREE.JS CANVAS ===== */
#three-canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none}
#app{position:relative;z-index:1}

/* ===== LOADING SCREEN ===== */
#loader{position:fixed;inset:0;z-index:9999;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .6s,visibility .6s}
#loader.hidden{opacity:0;visibility:hidden}
.loader-book{font-size:72px;animation:bookBounce 1s ease-in-out infinite}
.loader-text{margin-top:20px;font-size:20px;color:var(--gold);font-weight:500}
.loader-bar{width:200px;height:4px;background:rgba(255,255,255,.1);border-radius:4px;margin-top:16px;overflow:hidden}
.loader-fill{height:100%;background:linear-gradient(90deg,var(--purple),var(--cyan));border-radius:4px;animation:loadFill 1.5s ease-out forwards}
@keyframes bookBounce{0%,100%{transform:translateY(0) rotate(0)}50%{transform:translateY(-20px) rotate(5deg)}}
@keyframes loadFill{0%{width:0}100%{width:100%}}

/* ===== HEADER / HERO ===== */
.hero{text-align:center;padding:100px 24px 60px;position:relative}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(139,92,246,.15);border:1px solid rgba(139,92,246,.3);border-radius:999px;padding:8px 20px;font-size:14px;color:var(--purple);margin-bottom:24px;backdrop-filter:blur(8px)}
.hero h1{font-size:clamp(36px,7vw,72px);font-weight:700;line-height:1.1;margin-bottom:16px}
.hero h1 .magic{background:linear-gradient(135deg,var(--gold),var(--pink),var(--purple),var(--cyan));-webkit-background-clip:text;-webkit-text-color:transparent;background-clip:text;color:transparent;animation:gradientShift 4s ease infinite}
@keyframes gradientShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
.hero h1 .magic{background-size:300% 300%}
.hero-sub{font-size:clamp(16px,2.5vw,22px);color:var(--text-dim);max-width:600px;margin:0 auto 32px;line-height:1.6;font-weight:300}
.hero-emoji{font-size:48px;margin-bottom:16px;display:block}
.scroll-hint{display:inline-flex;flex-direction:column;align-items:center;gap:8px;color:var(--gold);font-size:14px;animation:float 2s ease-in-out infinite;cursor:pointer;text-decoration:none}
.scroll-hint svg{width:24px;height:24px;stroke:var(--gold);fill:none;stroke-width:2}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(8px)}}

/* ===== CHAPTER NAV ===== */
.chapter-nav{display:flex;flex-wrap:wrap;justify-content:center;gap:12px;padding:20px 24px 40px;max-width:900px;margin:0 auto}
.chapter-btn{display:flex;align-items:center;gap:10px;padding:12px 20px;border-radius:16px;border:2px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);color:var(--text);font-family:inherit;font-size:15px;font-weight:500;cursor:pointer;transition:all .3s;backdrop-filter:blur(8px)}
.chapter-btn:hover{border-color:rgba(255,255,255,.25);background:rgba(255,255,255,.08);transform:translateY(-2px)}
.chapter-btn.active{border-color:var(--active-color,var(--purple));background:rgba(139,92,246,.15);color:white;box-shadow:0 4px 20px rgba(139,92,246,.2)}
.chapter-btn .ch-emoji{font-size:22px}
.chapter-btn .ch-num{font-size:11px;opacity:.6;display:block;text-align:left}

/* ===== STORY SECTION ===== */
.story-container{max-width:1100px;margin:0 auto;padding:0 24px 80px}
.story-page{display:none;animation:fadeUp .5s ease}
.story-page.active{display:block}
@keyframes fadeUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}

/* Story Header */
.story-header{text-align:center;margin-bottom:40px}
.story-chapter{font-size:13px;text-transform:uppercase;letter-spacing:3px;color:var(--text-dim);margin-bottom:8px}
.story-title{font-size:clamp(28px,5vw,48px);font-weight:700;margin-bottom:8px}
.story-concept{font-size:18px;font-weight:500;padding:6px 18px;border-radius:999px;display:inline-block;margin-bottom:16px}
.story-intro{font-size:17px;color:var(--text-dim);max-width:650px;margin:0 auto;line-height:1.7}
.character-badge{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;border-radius:12px;font-size:14px;margin-bottom:16px;font-weight:500}

/* Story Grid */
.story-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:32px}
@media(max-width:768px){.story-grid{grid-template-columns:1fr}}

/* 3D Scene Card */
.scene-card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:24px;min-height:350px;position:relative;overflow:hidden}
.scene-card canvas{border-radius:12px}
.scene-label{position:absolute;bottom:16px;left:16px;font-size:12px;color:var(--text-dim);background:rgba(10,10,46,.8);padding:4px 12px;border-radius:8px;backdrop-filter:blur(8px)}

/* Narration Card */
.narration-card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:28px;display:flex;flex-direction:column;gap:20px}
.narration-text{font-size:17px;line-height:1.8;color:var(--text);flex:1}
.narration-text .highlight{color:var(--gold);font-weight:600}
.narration-text .code-inline{font-family:'Fira Code',monospace;background:rgba(139,92,246,.15);color:var(--purple);padding:2px 8px;border-radius:6px;font-size:14px}

/* Code Scroll */
.code-scroll{background:linear-gradient(135deg,rgba(20,20,60,.9),rgba(30,20,50,.9));border:1px solid rgba(139,92,246,.2);border-radius:16px;padding:24px;position:relative;overflow:hidden;margin-bottom:24px}
.code-scroll::before{content:'ğŸ“œ Magic Scroll';position:absolute;top:0;left:0;right:0;padding:8px 16px;background:rgba(139,92,246,.15);font-size:12px;letter-spacing:1px;text-transform:uppercase;color:var(--purple)}
.code-scroll pre{margin-top:28px;font-family:'Fira Code',monospace;font-size:14px;line-height:1.8;overflow-x:auto;color:#e2e8f0}
.code-scroll .kw{color:var(--purple);font-weight:500}
.code-scroll .str{color:var(--green)}
.code-scroll .num{color:var(--cyan)}
.code-scroll .fn{color:var(--gold)}
.code-scroll .cm{color:var(--text-dim);font-style:italic}
.code-scroll .op{color:var(--pink)}
.code-scroll .bi{color:var(--orange)}

/* Interactive Section */
.interactive-section{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:20px;padding:28px;margin-bottom:24px}
.interactive-section h3{font-size:20px;margin-bottom:16px;display:flex;align-items:center;gap:10px}
.interactive-section h3 .emoji{font-size:24px}

/* Buttons */
.btn{padding:12px 24px;border-radius:12px;border:none;font-family:inherit;font-size:15px;font-weight:600;cursor:pointer;transition:all .3s;display:inline-flex;align-items:center;gap:8px}
.btn-primary{background:var(--purple);color:white}
.btn-primary:hover{background:#7c3aed;transform:translateY(-2px);box-shadow:0 8px 25px rgba(139,92,246,.3)}
.btn-gold{background:var(--gold);color:#0a0a2e}
.btn-gold:hover{background:#f59e0b;transform:translateY(-2px)}
.btn-outline{background:transparent;border:2px solid rgba(255,255,255,.15);color:var(--text)}
.btn-outline:hover{border-color:rgba(255,255,255,.3);background:rgba(255,255,255,.05)}
.btn-sm{padding:8px 16px;font-size:13px;border-radius:8px}

/* Fun Fact */
.fun-fact{background:linear-gradient(135deg,rgba(251,191,36,.08),rgba(251,191,36,.03));border:1px solid rgba(251,191,36,.2);border-radius:16px;padding:20px;display:flex;gap:12px;align-items:flex-start}
.fun-fact .ff-icon{font-size:24px;flex-shrink:0}
.fun-fact .ff-title{font-size:13px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);margin-bottom:4px;font-weight:600}
.fun-fact .ff-text{font-size:14px;color:var(--text-dim);line-height:1.6}

/* ===== INTERACTIVE ELEMENTS ===== */

/* Story 1: Magic Backpack */
.backpack-zone{display:flex;flex-wrap:wrap;gap:16px;justify-content:center;margin:20px 0}
.pouch{width:140px;height:100px;background:linear-gradient(135deg,rgba(139,92,246,.2),rgba(139,92,246,.05));border:2px solid rgba(139,92,246,.3);border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .3s;position:relative}
.pouch:hover{transform:scale(1.05);border-color:var(--purple);box-shadow:0 8px 30px rgba(139,92,246,.2)}
.pouch.open{background:linear-gradient(135deg,rgba(16,185,129,.15),rgba(16,185,129,.05));border-color:var(--green)}
.pouch .pouch-label{font-size:12px;color:var(--text-dim);font-family:'Fira Code',monospace;margin-bottom:4px}
.pouch .pouch-icon{font-size:32px;transition:transform .3s}
.pouch.open .pouch-icon{transform:scale(1.2)}
.pouch .pouch-value{font-size:13px;color:var(--green);font-family:'Fira Code',monospace;margin-top:4px;opacity:0;transition:opacity .3s}
.pouch.open .pouch-value{opacity:1}
.var-output{text-align:center;margin-top:16px;font-family:'Fira Code',monospace;font-size:15px;color:var(--gold);min-height:24px;transition:all .3s}

/* Items to drag */
.items-shelf{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin:16px 0}
.drag-item{padding:10px 18px;background:rgba(251,191,36,.1);border:2px dashed rgba(251,191,36,.3);border-radius:12px;cursor:grab;font-size:14px;transition:all .3s;user-select:none}
.drag-item:hover{background:rgba(251,191,36,.2);transform:translateY(-2px)}
.drag-item.placed{opacity:.4;pointer-events:none}
.drop-zone{width:100%;min-height:80px;border:2px dashed rgba(139,92,246,.2);border-radius:16px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:center;padding:16px;margin:12px 0;transition:all .3s;color:var(--text-dim);font-size:14px}
.drop-zone.over{border-color:var(--green);background:rgba(16,185,129,.05)}
.drop-zone .placed-item{padding:6px 14px;background:rgba(16,185,129,.15);border:1px solid rgba(16,185,129,.3);border-radius:8px;color:var(--green);font-size:13px;font-family:'Fira Code',monospace}

/* Story 2: Dragon's Riddle */
.dragon-scene{text-align:center;margin:20px 0}
.dragon-speech{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.2);border-radius:16px;padding:20px;margin:16px auto;max-width:500px;font-size:16px;line-height:1.6;position:relative}
.dragon-speech::after{content:'';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid rgba(239,68,68,.2)}
.choice-buttons{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin:16px 0}
.choice-btn{padding:12px 24px;border-radius:12px;border:2px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);color:var(--text);font-family:inherit;font-size:15px;cursor:pointer;transition:all .3s;min-width:160px}
.choice-btn:hover{border-color:rgba(255,255,255,.25);background:rgba(255,255,255,.08);transform:translateY(-2px)}
.choice-btn.correct{border-color:var(--green);background:rgba(16,185,129,.15);color:var(--green)}
.choice-btn.wrong{border-color:var(--red);background:rgba(239,68,68,.1);color:var(--red);animation:shake .4s}
.choice-btn.almost{border-color:var(--orange);background:rgba(249,115,22,.1);color:var(--orange)}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.riddle-result{margin-top:16px;padding:16px;border-radius:12px;font-size:15px;display:none}
.riddle-result.show{display:block;animation:fadeUp .3s}

/* Story 3: Wizard's Spells */
.stars-grid{display:flex;gap:16px;justify-content:center;flex-wrap:wrap;margin:20px 0}
.spell-star{width:60px;height:60px;display:flex;align-items:center;justify-content:center;font-size:32px;border-radius:50%;background:rgba(255,255,255,.03);border:2px solid rgba(255,255,255,.08);transition:all .5s;opacity:.3}
.spell-star.lit{opacity:1;background:rgba(251,191,36,.15);border-color:var(--gold);box-shadow:0 0 20px rgba(251,191,36,.3);transform:scale(1.1)}
.spell-controls{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin:16px 0}
.spell-log{font-family:'Fira Code',monospace;font-size:13px;color:var(--text-dim);max-height:120px;overflow-y:auto;padding:12px;background:rgba(0,0,0,.2);border-radius:12px;margin-top:12px;line-height:1.8}
.spell-log .log-line{animation:fadeUp .3s}
.spell-log .log-iter{color:var(--cyan)}
.spell-log .log-action{color:var(--gold)}
.loop-counter{text-align:center;font-size:24px;font-weight:700;color:var(--purple);margin:12px 0}

/* Story 4: Recipe Book */
.kitchen-area{text-align:center;margin:20px 0}
.ingredient-shelf{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin:16px 0}
.ingredient{padding:10px 20px;border-radius:12px;border:2px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);font-size:15px;cursor:pointer;transition:all .3s}
.ingredient:hover{border-color:rgba(255,255,255,.2);background:rgba(255,255,255,.06);transform:translateY(-2px)}
.ingredient.selected{border-color:var(--green);background:rgba(16,185,129,.1);color:var(--green)}
.cauldron{width:120px;height:120px;margin:20px auto;background:radial-gradient(circle,rgba(139,92,246,.2),rgba(139,92,246,.05));border:3px solid rgba(139,92,246,.3);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:48px;transition:all .5s;position:relative}
.cauldron.brewing{animation:brew 1s ease;border-color:var(--gold);box-shadow:0 0 40px rgba(251,191,36,.2)}
@keyframes brew{0%{transform:scale(1) rotate(0)}25%{transform:scale(1.1) rotate(-5deg)}50%{transform:scale(1.15) rotate(5deg)}75%{transform:scale(1.1) rotate(-3deg)}100%{transform:scale(1) rotate(0)}}
.recipe-result{font-size:18px;font-weight:600;color:var(--gold);margin:16px 0;min-height:28px}
.recipe-code-live{font-family:'Fira Code',monospace;font-size:14px;padding:16px;background:rgba(0,0,0,.2);border-radius:12px;text-align:left;margin:16px 0;color:var(--text-dim);line-height:1.8}
.recipe-code-live .active-line{color:var(--gold)}

/* Story 5: Toy Box */
.toybox{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:20px 0;min-height:80px;padding:16px;border:2px solid rgba(139,92,246,.2);border-radius:16px;background:rgba(139,92,246,.03);align-items:center}
.toy-slot{width:80px;height:80px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(255,255,255,.03);border:2px solid rgba(255,255,255,.08);border-radius:12px;transition:all .3s;cursor:pointer;gap:4px}
.toy-slot:hover{border-color:rgba(255,255,255,.2);transform:translateY(-2px)}
.toy-slot .toy-emoji{font-size:28px}
.toy-slot .toy-index{font-size:10px;font-family:'Fira Code',monospace;color:var(--text-dim)}
.toy-controls{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin:16px 0;align-items:center}
.toy-input{padding:10px 16px;border-radius:10px;border:2px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);color:var(--text);font-family:inherit;font-size:14px;width:140px;outline:none;transition:border-color .3s}
.toy-input:focus{border-color:var(--purple)}
.toy-output{font-family:'Fira Code',monospace;font-size:14px;color:var(--cyan);text-align:center;margin:12px 0;min-height:22px}
.toy-list-display{font-family:'Fira Code',monospace;font-size:15px;text-align:center;margin:12px 0;padding:12px;background:rgba(0,0,0,.2);border-radius:12px;color:var(--green)}

/* ===== NAV ARROWS ===== */
.story-nav{display:flex;justify-content:space-between;align-items:center;padding:24px 0;margin-top:24px;border-top:1px solid rgba(255,255,255,.06)}
.nav-arrow{display:flex;align-items:center;gap:8px;padding:12px 20px;border-radius:12px;border:2px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);color:var(--text);font-family:inherit;font-size:14px;cursor:pointer;transition:all .3s;font-weight:500}
.nav-arrow:hover{border-color:rgba(255,255,255,.2);background:rgba(255,255,255,.06);transform:translateY(-2px)}
.nav-arrow.disabled{opacity:.3;pointer-events:none}
.nav-progress{display:flex;gap:6px}
.nav-dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.1);transition:all .3s}
.nav-dot.active{background:var(--purple);box-shadow:0 0 10px rgba(139,92,246,.4)}
.nav-dot.done{background:var(--green)}

/* ===== FOOTER ===== */
.site-footer{text-align:center;padding:40px 24px 60px;border-top:1px solid rgba(255,255,255,.06);color:var(--text-dim);font-size:14px}
.site-footer a{color:var(--purple);text-decoration:none}
.site-footer a:hover{text-decoration:underline}

/* ===== RESPONSIVE ===== */
@media(max-width:600px){
  .chapter-btn{padding:10px 14px;font-size:13px}
  .chapter-btn .ch-num{display:none}
  .pouch{width:110px;height:85px}
  .spell-star{width:48px;height:48px;font-size:24px}
  .toy-slot{width:65px;height:65px}
  .toy-slot .toy-emoji{font-size:22px}
  .code-scroll pre{font-size:12px}
}

/* ===== SPARKLE CURSOR ===== */
.sparkle{position:fixed;pointer-events:none;z-index:9999;font-size:12px;animation:sparkleFloat 1s ease-out forwards}
@keyframes sparkleFloat{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-40px) scale(0)}}
</style>
</head>
<body>

<!-- Loading Screen -->
<div id="loader">
  <div class="loader-book">ğŸ“–</div>
  <div class="loader-text">Opening your storybook...</div>
  <div class="loader-bar"><div class="loader-fill"></div></div>
</div>

<!-- Three.js Background -->
<canvas id="three-canvas"></canvas>

<div id="app">

  <!-- Hero -->
  <header class="hero">
    <span class="hero-emoji">ğŸâœ¨ğŸ“–</span>
    <div class="hero-badge">ğŸª„ 5 Magical Stories â€¢ 5 Python Concepts</div>
    <h1>Python<br><span class="magic">Adventures</span></h1>
    <p class="hero-sub">Learn Python through magical stories! Meet Luna, a friendly dragon, wizard Kai, chef Maya, and Zara â€” each teaches you a Python superpower!</p>
    <a href="#chapters" class="scroll-hint">
      Choose a Story
      <svg viewBox="0 0 24 24"><path d="M12 5v14M5 12l7 7 7-7"/></svg>
    </a>
  </header>

  <!-- Chapter Navigation -->
  <nav class="chapter-nav" id="chapters">
    <button class="chapter-btn active" onclick="goToStory(0)" style="--active-color:#8b5cf6">
      <span class="ch-emoji">ğŸ’</span>
      <div><span class="ch-num">Chapter 1</span>Variables</div>
    </button>
    <button class="chapter-btn" onclick="goToStory(1)" style="--active-color:#ef4444">
      <span class="ch-emoji">ğŸ‰</span>
      <div><span class="ch-num">Chapter 2</span>If / Else</div>
    </button>
    <button class="chapter-btn" onclick="goToStory(2)" style="--active-color:#06b6d4">
      <span class="ch-emoji">ğŸ§™</span>
      <div><span class="ch-num">Chapter 3</span>Loops</div>
    </button>
    <button class="chapter-btn" onclick="goToStory(3)" style="--active-color:#10b981">
      <span class="ch-emoji">ğŸ‘©â€ğŸ³</span>
      <div><span class="ch-num">Chapter 4</span>Functions</div>
    </button>
    <button class="chapter-btn" onclick="goToStory(4)" style="--active-color:#ec4899">
      <span class="ch-emoji">ğŸ§¸</span>
      <div><span class="ch-num">Chapter 5</span>Lists</div>
    </button>
  </nav>

  <!-- Story Container -->
  <div class="story-container">

    <!-- ==================== STORY 1: THE MAGIC BACKPACK ==================== -->
    <div class="story-page active" id="story-0">
      <div class="story-header">
        <div class="story-chapter">Chapter 1</div>
        <h2 class="story-title" style="color:var(--purple)">The Magic Backpack âœ¨</h2>
        <div class="character-badge" style="background:rgba(139,92,246,.1);color:var(--purple)">ğŸ‘§ Meet Luna, the Young Explorer</div>
        <div class="story-concept" style="background:rgba(139,92,246,.1);color:var(--purple)">Python Concept: Variables</div>
        <p class="story-intro">Luna has a magical backpack with special pouches. Each pouch has a <em>label</em> on it and holds something inside â€” just like <strong>variables</strong> in Python store data!</p>
      </div>

      <div class="story-grid">
        <div class="scene-card" id="scene-1">
          <div class="scene-label">ğŸ’ Luna's Magic Backpack â€” Click to explore!</div>
        </div>
        <div class="narration-card">
          <div class="narration-text">
            <p>Luna found a <span class="highlight">magic backpack</span> in the forest! ğŸŒ²</p>
            <p style="margin-top:12px">It has special pouches with <strong>labels</strong>. When Luna writes a label and puts something inside, the backpack remembers it forever!</p>
            <p style="margin-top:12px">In Python, we call these <span class="highlight">variables</span>. A variable has a <strong>name</strong> (the label) and a <strong>value</strong> (what's inside).</p>
            <p style="margin-top:12px">Click the pouches below to see what Luna stored! ğŸ‘‡</p>
          </div>
        </div>
      </div>

      <div class="code-scroll">
        <pre><span class="cm"># Luna labels her pouches (creates variables!)</span>
<span class="fn">name</span> <span class="op">=</span> <span class="str">"Luna"</span>        <span class="cm"># A string (text)</span>
<span class="fn">age</span> <span class="op">=</span> <span class="num">10</span>             <span class="cm"># An integer (number)</span>
<span class="fn">snack</span> <span class="op">=</span> <span class="str">"cookies"</span>   <span class="cm"># Another string</span>
<span class="fn">has_map</span> <span class="op">=</span> <span class="kw">True</span>        <span class="cm"># A boolean (yes/no)</span>
<span class="fn">coins</span> <span class="op">=</span> <span class="num">3.5</span>           <span class="cm"># A float (decimal)</span>

<span class="cm"># Python remembers what's in each pouch!</span>
<span class="bi">print</span>(<span class="fn">name</span>)     <span class="cm"># Output: Luna</span>
<span class="bi">print</span>(<span class="fn">age</span>)      <span class="cm"># Output: 10</span></pre>
      </div>

      <div class="interactive-section">
        <h3><span class="emoji">ğŸ’</span> Click Luna's Pouches!</h3>
        <p style="color:var(--text-dim);margin-bottom:16px;font-size:14px">Each pouch is a variable â€” click to reveal what's stored inside!</p>
        <div class="backpack-zone" id="backpack">
          <div class="pouch" onclick="openPouch(this,'name','&quot;Luna&quot;','ğŸ‘§')">
            <div class="pouch-label">name</div>
            <div class="pouch-icon">â“</div>
            <div class="pouch-value">"Luna"</div>
          </div>
          <div class="pouch" onclick="openPouch(this,'age','10','ğŸ”¢')">
            <div class="pouch-label">age</div>
            <div class="pouch-icon">â“</div>
            <div class="pouch-value">10</div>
          </div>
          <div class="pouch" onclick="openPouch(this,'snack','&quot;cookies&quot;','ğŸª')">
            <div class="pouch-label">snack</div>
            <div class="pouch-icon">â“</div>
            <div class="pouch-value">"cookies"</div>
          </div>
          <div class="pouch" onclick="openPouch(this,'has_map','True','ğŸ—ºï¸')">
            <div class="pouch-label">has_map</div>
            <div class="pouch-icon">â“</div>
            <div class="pouch-value">True</div>
          </div>
          <div class="pouch" onclick="openPouch(this,'coins','3.5','ğŸ’°')">
            <div class="pouch-label">coins</div>
            <div class="pouch-icon">â“</div>
            <div class="pouch-value">3.5</div>
          </div>
        </div>
        <div class="var-output" id="var-output"></div>
      </div>

      <div class="interactive-section">
        <h3><span class="emoji">ğŸ§³</span> Pack Luna's Backpack!</h3>
        <p style="color:var(--text-dim);margin-bottom:16px;font-size:14px">Click items to store them as variables in Luna's backpack:</p>
        <div class="items-shelf" id="items-shelf">
          <div class="drag-item" onclick="packItem(this,'ğŸ§­ compass')">ğŸ§­ compass</div>
          <div class="drag-item" onclick="packItem(this,'ğŸ“” journal')">ğŸ“” journal</div>
          <div class="drag-item" onclick="packItem(this,'ğŸ”‘ key')">ğŸ”‘ key</div>
          <div class="drag-item" onclick="packItem(this,'ğŸ apple')">ğŸ apple</div>
          <div class="drag-item" onclick="packItem(this,'â­ star')">â­ star</div>
        </div>
        <div class="drop-zone" id="drop-zone">Drop zone â€” click items above to pack!</div>
        <div class="var-output" id="pack-output"></div>
      </div>

      <div class="fun-fact">
        <div class="ff-icon">ğŸ’¡</div>
        <div>
          <div class="ff-title">Fun Fact!</div>
          <div class="ff-text">Variable names in Python can't start with a number! <code>1name</code> won't work, but <code>name1</code> will. Also, Python is <strong>case-sensitive</strong> â€” <code>Name</code> and <code>name</code> are different variables!</div>
        </div>
      </div>
    </div>

    <!-- ==================== STORY 2: THE DRAGON'S RIDDLE ==================== -->
    <div class="story-page" id="story-1">
      <div class="story-header">
        <div class="story-chapter">Chapter 2</div>
        <h2 class="story-title" style="color:var(--red)">The Dragon's Riddle ğŸ”¥</h2>
        <div class="character-badge" style="background:rgba(239,68,68,.1);color:var(--red)">ğŸ‰ Meet the Friendly Dragon</div>
        <div class="story-concept" style="background:rgba(239,68,68,.1);color:var(--red)">Python Concept: If / Else</div>
        <p class="story-intro">A friendly dragon guards a magical cave. To enter, you must answer riddles correctly! The dragon checks your answers using <strong>if</strong>, <strong>elif</strong>, and <strong>else</strong> â€” just like Python!</p>
      </div>

      <div class="story-grid">
        <div class="scene-card" id="scene-2">
          <div class="scene-label">ğŸ‰ The Dragon's Cave â€” Answer wisely!</div>
        </div>
        <div class="narration-card">
          <div class="narration-text">
            <p>Deep in the mountains, Luna found a <span class="highlight">glowing cave</span> guarded by a big, friendly dragon! ğŸ”ï¸</p>
            <p style="margin-top:12px">The dragon smiled and said: <em>"To enter my cave, you must answer my riddle! I'll check your answerâ€¦"</em></p>
            <p style="margin-top:12px">In Python, we use <span class="code-inline">if</span>, <span class="code-inline">elif</span>, and <span class="code-inline">else</span> to check conditions â€” just like the dragon checks answers!</p>
            <p style="margin-top:12px">Try answering the dragon's riddles below! ğŸ‰</p>
          </div>
        </div>
      </div>

      <div class="code-scroll">
        <pre><span class="cm"># The dragon checks your answer!</span>
<span class="fn">password</span> <span class="op">=</span> <span class="bi">input</span>(<span class="str">"What's the magic word? "</span>)

<span class="kw">if</span> <span class="fn">password</span> <span class="op">==</span> <span class="str">"friendship"</span>:
    <span class="bi">print</span>(<span class="str">"âœ¨ The door opens! Welcome, friend!"</span>)
<span class="kw">elif</span> <span class="fn">password</span> <span class="op">==</span> <span class="str">"friend"</span>:
    <span class="bi">print</span>(<span class="str">"ğŸ¤” So close! Almost the right word..."</span>)
<span class="kw">else</span>:
    <span class="bi">print</span>(<span class="str">"âŒ That's not it. Try again!"</span>)

<span class="cm"># The dragon also knows numbers!</span>
<span class="fn">gems</span> <span class="op">=</span> <span class="num">5</span>
<span class="kw">if</span> <span class="fn">gems</span> <span class="op">>=</span> <span class="num">3</span>:
    <span class="bi">print</span>(<span class="str">"You're rich! ğŸ’"</span>)
<span class="kw">else</span>:
    <span class="bi">print</span>(<span class="str">"Keep searching!"</span>)</pre>
      </div>

      <div class="interactive-section">
        <h3><span class="emoji">ğŸ‰</span> The Dragon's Riddle</h3>
        <div class="dragon-scene">
          <div class="dragon-speech" id="dragon-speech">
            ğŸ‰ "What is the magic word to enter my cave? Choose wisely, young adventurer!"
          </div>
          <div class="choice-buttons" id="riddle-choices">
            <button class="choice-btn" onclick="answerRiddle(this,'fire')">ğŸ”¥ "fire"</button>
            <button class="choice-btn" onclick="answerRiddle(this,'friend')">ğŸ¤ "friend"</button>
            <button class="choice-btn" onclick="answerRiddle(this,'friendship')">ğŸ’› "friendship"</button>
            <button class="choice-btn" onclick="answerRiddle(this,'magic')">âœ¨ "magic"</button>
          </div>
          <div class="riddle-result" id="riddle-result"></div>
        </div>
      </div>

      <div class="interactive-section">
        <h3><span class="emoji">ğŸ¯</span> Riddle Round 2: Number Check!</h3>
        <div class="dragon-scene">
          <div class="dragon-speech" id="dragon-speech-2">
            ğŸ‰ "How many stars are in the sky tonight? I'll check if it's greater than, less than, or equal to 7!"
          </div>
          <div class="choice-buttons" id="riddle-choices-2">
            <button class="choice-btn" onclick="answerRiddle2(this,3)">3 stars</button>
            <button class="choice-btn" onclick="answerRiddle2(this,7)">7 stars</button>
            <button class="choice-btn" onclick="answerRiddle2(this,10)">10 stars</button>
          </div>
          <div class="riddle-result" id="riddle-result-2"></div>
        </div>
      </div>

      <div class="fun-fact">
        <div class="ff-icon">ğŸ’¡</div>
        <div>
          <div class="ff-title">Fun Fact!</div>
          <div class="ff-text">In Python, <code>==</code> means "is equal to?" (a question), while <code>=</code> means "set this to" (a command). The dragon <em>asks</em> with <code>==</code> but Luna <em>stores</em> with <code>=</code>!</div>
        </div>
      </div>
    </div>

    <!-- ==================== STORY 3: THE WIZARD'S SPELL ==================== -->
    <div class="story-page" id="story-2">
      <div class="story-header">
        <div class="story-chapter">Chapter 3</div>
        <h2 class="story-title" style="color:var(--cyan)">The Wizard's Spell ğŸŒŸ</h2>
        <div class="character-badge" style="background:rgba(6,182,212,.1);color:var(--cyan)">ğŸ§™ Meet Kai, the Young Wizard</div>
        <div class="story-concept" style="background:rgba(6,182,212,.1);color:var(--cyan)">Python Concept: Loops</div>
        <p class="story-intro">Wizard Kai learns spells that <em>repeat</em> actions! Lighting stars one by one, battling dragons in a row â€” loops are the wizard's most powerful tool!</p>
      </div>

      <div class="story-grid">
        <div class="scene-card" id="scene-3">
          <div class="scene-label">ğŸŒŸ Kai's Star Spell â€” Cast the spell!</div>
        </div>
        <div class="narration-card">
          <div class="narration-text">
            <p>Young wizard <span class="highlight">Kai</span> stood under the night sky. His teacher said: <em>"To light the stars, you must cast a repeating spell!"</em> ğŸŒ™</p>
            <p style="margin-top:12px">A <span class="code-inline">for</span> loop repeats something a set number of times. A <span class="code-inline">while</span> loop repeats as long as a condition is true!</p>
            <p style="margin-top:12px">Kai raised his wand: <em>"For each star in the skyâ€¦ GLOW!"</em> âœ¨</p>
            <p style="margin-top:12px">Click the spell button below to watch Kai light the stars one by one!</p>
          </div>
        </div>
      </div>

      <div class="code-scroll">
        <pre><span class="cm"># Kai's star-lighting spell (for loop)</span>
<span class="kw">for</span> <span class="fn">star</span> <span class="kw">in</span> <span class="bi">range</span>(<span class="num">5</span>):
    <span class="bi">print</span>(<span class="str">f"â­ Star </span><span class="op">{</span><span class="fn">star</span><span class="op">}</span><span class="str"> is glowing!"</span>)

<span class="cm"># Kai's dragon battle (while loop)</span>
<span class="fn">dragons</span> <span class="op">=</span> <span class="num">3</span>
<span class="kw">while</span> <span class="fn">dragons</span> <span class="op">></span> <span class="num">0</span>:
    <span class="bi">print</span>(<span class="str">f"ğŸ‰ Fighting dragon! </span><span class="op">{</span><span class="fn">dragons</span><span class="op">}</span><span class="str"> left"</span>)
    <span class="fn">dragons</span> <span class="op">-=</span> <span class="num">1</span>    <span class="cm"># One dragon defeated!</span>
<span class="bi">print</span>(<span class="str">"ğŸ‰ All dragons defeated!"</span>)</pre>
      </div>

      <div class="interactive-section">
        <h3><span class="emoji">â­</span> Cast the Star Spell! (for loop)</h3>
        <p style="color:var(--text-dim);margin-bottom:16px;font-size:14px">Watch Kai light stars one by one using <code>for star in range(5)</code></p>
        <div class="stars-grid" id="stars-grid">
          <div class="spell-star" id="star-0">â­</div>
          <div class="spell-star" id="star-1">â­</div>
          <div class="spell-star" id="star-2">â­</div>
          <div class="spell-star" id="star-3">â­</div>
          <div class="spell-star" id="star-4">â­</div>
        </div>
        <div class="loop-counter" id="loop-counter">Ready to cast!</div>
        <div class="spell-controls">
          <button class="btn btn-primary" onclick="castStarSpell()">ğŸª„ Cast Star Spell</button>
          <button class="btn btn-outline" onclick="resetStars()">ğŸ”„ Reset</button>
        </div>
        <div class="spell-log" id="star-log"></div>
      </div>

      <div class="interactive-section">
        <h3><span class="emoji">ğŸ‰</span> Dragon Battle! (while loop)</h3>
        <p style="color:var(--text-dim);margin-bottom:16px;font-size:14px">Watch Kai fight dragons using <code>while dragons > 0</code></p>
        <div class="stars-grid" id="dragons-grid">
          <div class="spell-star" id="dragon-0">ğŸ‰</div>
          <div class="spell-star" id="dragon-1">ğŸ‰</div>
          <div class="spell-star" id="dragon-2">ğŸ‰</div>
        </div>
        <div class="loop-counter" id="dragon-counter">dragons = 3</div>
        <div class="spell-controls">
          <button class="btn btn-primary" onclick="fightDragons()">âš”ï¸ Fight Dragons</button>
          <button class="btn btn-outline" onclick="resetDragons()">ğŸ”„ Reset</button>
        </div>
        <div class="spell-log" id="dragon-log"></div>
      </div>

      <div class="fun-fact">
        <div class="ff-icon">ğŸ’¡</div>
        <div>
          <div class="ff-title">Fun Fact!</div>
          <div class="ff-text"><code>range(5)</code> gives you numbers 0, 1, 2, 3, 4 â€” that's 5 numbers but starting from 0! Programmers love counting from zero. ğŸ¤“ You can also use <code>break</code> to stop a loop early and <code>continue</code> to skip one round!</div>
        </div>
      </div>
    </div>

    <!-- ==================== STORY 4: THE RECIPE BOOK ==================== -->
    <div class="story-page" id="story-3">
      <div class="story-header">
        <div class="story-chapter">Chapter 4</div>
        <h2 class="story-title" style="color:var(--green)">The Recipe Book ğŸ§ª</h2>
        <div class="character-badge" style="background:rgba(16,185,129,.1);color:var(--green)">ğŸ‘©â€ğŸ³ Meet Maya, the Magical Chef</div>
        <div class="story-concept" style="background:rgba(16,185,129,.1);color:var(--green)">Python Concept: Functions</div>
        <p class="story-intro">Chef Maya's recipe book is magical! Each recipe is a <strong>function</strong> â€” you give it ingredients (parameters) and it returns a delicious dish (return value)!</p>
      </div>

      <div class="story-grid">
        <div class="scene-card" id="scene-4">
          <div class="scene-label">ğŸ§ª Maya's Kitchen â€” Pick ingredients!</div>
        </div>
        <div class="narration-card">
          <div class="narration-text">
            <p>Chef <span class="highlight">Maya</span> has a magical kitchen! Her recipe book contains special recipes called <strong>functions</strong>. ğŸ³</p>
            <p style="margin-top:12px">Each recipe needs <em>ingredients</em> â€” in Python, we call these <span class="code-inline">parameters</span>. The recipe produces a dish â€” that's the <span class="code-inline">return value</span>!</p>
            <p style="margin-top:12px">The best part? Once you write a recipe, you can <strong>reuse</strong> it anytime with different ingredients!</p>
            <p style="margin-top:12px">Try mixing ingredients in Maya's cauldron! ğŸ§™â€â™€ï¸</p>
          </div>
        </div>
      </div>

      <div class="code-scroll">
        <pre><span class="cm"># Maya's magical recipe (a function!)</span>
<span class="kw">def</span> <span class="fn">make_potion</span>(<span class="fn">ingredient</span>):
    <span class="str">"""A recipe that takes an ingredient and returns a potion"""</span>
    <span class="fn">potion</span> <span class="op">=</span> <span class="str">"magical "</span> <span class="op">+</span> <span class="fn">ingredient</span> <span class="op">+</span> <span class="str">" potion"</span>
    <span class="kw">return</span> <span class="fn">potion</span>

<span class="cm"># Call the function with different ingredients!</span>
<span class="fn">drink1</span> <span class="op">=</span> <span class="fn">make_potion</span>(<span class="str">"starlight"</span>)   <span class="cm"># "magical starlight potion"</span>
<span class="fn">drink2</span> <span class="op">=</span> <span class="fn">make_potion</span>(<span class="str">"moonbeam"</span>)    <span class="cm"># "magical moonbeam potion"</span>

<span class="cm"># A recipe with multiple ingredients</span>
<span class="kw">def</span> <span class="fn">make_cake</span>(<span class="fn">flavor</span>, <span class="fn">layers</span><span class="op">=</span><span class="num">3</span>):
    <span class="kw">return</span> <span class="str">f"A </span><span class="op">{</span><span class="fn">layers</span><span class="op">}</span><span class="str">-layer </span><span class="op">{</span><span class="fn">flavor</span><span class="op">}</span><span class="str"> cake! ğŸ‚"</span></pre>
      </div>

      <div class="interactive-section">
        <h3><span class="emoji">ğŸ§ª</span> Maya's Potion Lab!</h3>
        <p style="color:var(--text-dim);margin-bottom:16px;font-size:14px">Pick an ingredient to put into the <code>make_potion()</code> function:</p>
        <div class="ingredient-shelf" id="ingredients">
          <div class="ingredient" onclick="selectIngredient(this,'ğŸŒŸ starlight')">ğŸŒŸ starlight</div>
          <div class="ingredient" onclick="selectIngredient(this,'ğŸŒ™ moonbeam')">ğŸŒ™ moonbeam</div>
          <div class="ingredient" onclick="selectIngredient(this,'ğŸ”¥ dragonfire')">ğŸ”¥ dragonfire</div>
          <div class="ingredient" onclick="selectIngredient(this,'â„ï¸ frost')">â„ï¸ frost</div>
          <div class="ingredient" onclick="selectIngredient(this,'ğŸŒ¸ blossom')">ğŸŒ¸ blossom</div>
          <div class="ingredient" onclick="selectIngredient(this,'âš¡ thunder')">âš¡ thunder</div>
        </div>
        <div class="cauldron" id="cauldron">ğŸ§ª</div>
        <div style="text-align:center">
          <button class="btn btn-gold" onclick="brewPotion()">ğŸª„ Brew Potion!</button>
        </div>
        <div class="recipe-result" id="recipe-result"></div>
        <div class="recipe-code-live" id="recipe-live">
          <span class="cm"># Pick an ingredient above...</span><br>
          <span>make_potion( ? )</span>
        </div>
      </div>

      <div class="fun-fact">
        <div class="ff-icon">ğŸ’¡</div>
        <div>
          <div class="ff-title">Fun Fact!</div>
          <div class="ff-text">Functions are like recipes you can use over and over! Python has built-in functions like <code>print()</code>, <code>len()</code>, and <code>input()</code>. When you write your own, use <code>def</code> (short for "define") to name your recipe!</div>
        </div>
      </div>
    </div>

    <!-- ==================== STORY 5: THE MAGICAL TOY BOX ==================== -->
    <div class="story-page" id="story-4">
      <div class="story-header">
        <div class="story-chapter">Chapter 5</div>
        <h2 class="story-title" style="color:var(--pink)">The Magical Toy Box ğŸ</h2>
        <div class="character-badge" style="background:rgba(236,72,153,.1);color:var(--pink)">ğŸ§¸ Meet Zara and Her Toy Collection</div>
        <div class="story-concept" style="background:rgba(236,72,153,.1);color:var(--pink)">Python Concept: Lists</div>
        <p class="story-intro">Zara has an enchanted toy box with numbered slots! She can add, remove, and find toys â€” just like a <strong>list</strong> in Python!</p>
      </div>

      <div class="story-grid">
        <div class="scene-card" id="scene-5">
          <div class="scene-label">ğŸ Zara's Toy Box â€” Manage the toys!</div>
        </div>
        <div class="narration-card">
          <div class="narration-text">
            <p><span class="highlight">Zara</span> received a magical toy box for her birthday! ğŸ‚</p>
            <p style="margin-top:12px">The toy box has <strong>numbered slots</strong> starting from 0. She can put toys in, take them out, count them, and find them by number!</p>
            <p style="margin-top:12px">In Python, a <span class="code-inline">list</span> works just like this. It stores multiple items in order, and you can access them by their <strong>index</strong> (slot number)!</p>
            <p style="margin-top:12px">Try managing Zara's toy box below! ğŸ§¸</p>
          </div>
        </div>
      </div>

      <div class="code-scroll">
        <pre><span class="cm"># Zara's toy box (a list!)</span>
<span class="fn">toys</span> <span class="op">=</span> [<span class="str">"ğŸ§¸ teddy"</span>, <span class="str">"ğŸ¤– robot"</span>, <span class="str">"ğŸ‰ dragon"</span>]

<span class="cm"># Access by index (slot number)</span>
<span class="bi">print</span>(<span class="fn">toys</span>[<span class="num">0</span>])       <span class="cm"># ğŸ§¸ teddy (first!)</span>
<span class="bi">print</span>(<span class="fn">toys</span>[<span class="num">-1</span>])      <span class="cm"># ğŸ‰ dragon (last!)</span>

<span class="cm"># Add a toy</span>
<span class="fn">toys</span>.<span class="fn">append</span>(<span class="str">"ğŸ¦„ unicorn"</span>)  <span class="cm"># Add to the end</span>

<span class="cm"># Remove a toy</span>
<span class="fn">toys</span>.<span class="fn">remove</span>(<span class="str">"ğŸ¤– robot"</span>)   <span class="cm"># Find and remove</span>

<span class="cm"># How many toys?</span>
<span class="bi">print</span>(<span class="bi">len</span>(<span class="fn">toys</span>))    <span class="cm"># 3 toys!</span></pre>
      </div>

      <div class="interactive-section">
        <h3><span class="emoji">ğŸ</span> Zara's Toy Box!</h3>
        <div class="toy-list-display" id="toy-list-code">toys = ["ğŸ§¸ teddy", "ğŸ¤– robot", "ğŸ‰ dragon"]</div>
        <div class="toybox" id="toybox"></div>
        <div class="toy-controls">
          <input type="text" class="toy-input" id="toy-input" placeholder="Toy name..." list="toy-suggestions">
          <datalist id="toy-suggestions">
            <option value="ğŸ¦„ unicorn">
            <option value="ğŸš€ rocket">
            <option value="ğŸ¸ guitar">
            <option value="ğŸ§© puzzle">
            <option value="âš½ ball">
            <option value="ğŸ¨ art set">
          </datalist>
          <button class="btn btn-primary btn-sm" onclick="addToy()">append()</button>
          <button class="btn btn-outline btn-sm" onclick="removeToy()">remove()</button>
          <button class="btn btn-outline btn-sm" onclick="popToy()">pop()</button>
        </div>
        <div class="toy-controls">
          <input type="number" class="toy-input" id="toy-index" placeholder="Index..." min="0" style="width:100px">
          <button class="btn btn-outline btn-sm" onclick="getToy()">toys[i]</button>
          <button class="btn btn-outline btn-sm" onclick="toyLen()">len()</button>
          <button class="btn btn-outline btn-sm" onclick="resetToys()">ğŸ”„ Reset</button>
        </div>
        <div class="toy-output" id="toy-output"></div>
      </div>

      <div class="fun-fact">
        <div class="ff-icon">ğŸ’¡</div>
        <div>
          <div class="ff-title">Fun Fact!</div>
          <div class="ff-text">Lists start counting at 0, not 1! So the first toy is <code>toys[0]</code>. You can also use negative numbers: <code>toys[-1]</code> gives the LAST item! It's like counting backwards. ğŸ”„</div>
        </div>
      </div>
    </div>

  </div>

  <!-- Story Navigation -->
  <div class="story-container">
    <div class="story-nav">
      <button class="nav-arrow" id="nav-prev" onclick="prevStory()">â† Previous Story</button>
      <div class="nav-progress">
        <div class="nav-dot active" onclick="goToStory(0)"></div>
        <div class="nav-dot" onclick="goToStory(1)"></div>
        <div class="nav-dot" onclick="goToStory(2)"></div>
        <div class="nav-dot" onclick="goToStory(3)"></div>
        <div class="nav-dot" onclick="goToStory(4)"></div>
      </div>
      <button class="nav-arrow" id="nav-next" onclick="nextStory()">Next Story â†’</button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="site-footer">
    <p>Made with ğŸ’œ for young coders everywhere</p>
    <p style="margin-top:8px">Part of <a href="https://rathishkumarlearning.github.io/course-hub/" target="_blank">Rathish's Learning Hub</a> â€¢ Free & Open Source</p>
  </footer>

</div>

<script>
// ========================================
// STATE
// ========================================
let currentStory = 0;
const totalStories = 5;
let toyList = ['ğŸ§¸ teddy', 'ğŸ¤– robot', 'ğŸ‰ dragon'];
let selectedIngredient = null;
let starSpellRunning = false;
let dragonFightRunning = false;
let packedItems = [];

// ========================================
// THREE.JS BACKGROUND
// ========================================
(function initThree() {
  const canvas = document.getElementById('three-canvas');
  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
  camera.position.z = 30;

  // Stars
  const starsGeo = new THREE.BufferGeometry();
  const starsCount = 800;
  const positions = new Float32Array(starsCount * 3);
  const colors = new Float32Array(starsCount * 3);
  const sizes = new Float32Array(starsCount);
  for (let i = 0; i < starsCount; i++) {
    positions[i * 3] = (Math.random() - 0.5) * 80;
    positions[i * 3 + 1] = (Math.random() - 0.5) * 80;
    positions[i * 3 + 2] = (Math.random() - 0.5) * 50;
    const c = new THREE.Color();
    c.setHSL(0.6 + Math.random() * 0.3, 0.6, 0.7 + Math.random() * 0.3);
    colors[i * 3] = c.r;
    colors[i * 3 + 1] = c.g;
    colors[i * 3 + 2] = c.b;
    sizes[i] = Math.random() * 2 + 0.5;
  }
  starsGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  starsGeo.setAttribute('color', new THREE.BufferAttribute(colors, 3));
  const starsMat = new THREE.PointsMaterial({ size: 1.5, vertexColors: true, transparent: true, opacity: 0.6, sizeAttenuation: true });
  const stars = new THREE.Points(starsGeo, starsMat);
  scene.add(stars);

  // Floating geometric shapes (story elements)
  const shapes = [];
  const geoTypes = [
    new THREE.IcosahedronGeometry(0.8, 0),
    new THREE.OctahedronGeometry(0.7, 0),
    new THREE.TetrahedronGeometry(0.7, 0),
    new THREE.DodecahedronGeometry(0.6, 0),
    new THREE.TorusGeometry(0.5, 0.2, 8, 16),
  ];
  const matColors = [0x8b5cf6, 0xfbbf24, 0x06b6d4, 0xec4899, 0x10b981];
  for (let i = 0; i < 12; i++) {
    const geo = geoTypes[i % geoTypes.length];
    const mat = new THREE.MeshBasicMaterial({
      color: matColors[i % matColors.length],
      wireframe: true,
      transparent: true,
      opacity: 0.15,
    });
    const mesh = new THREE.Mesh(geo, mat);
    mesh.position.set(
      (Math.random() - 0.5) * 40,
      (Math.random() - 0.5) * 40,
      (Math.random() - 0.5) * 20 - 5
    );
    mesh.userData = {
      rotSpeed: (Math.random() - 0.5) * 0.02,
      floatSpeed: 0.3 + Math.random() * 0.5,
      floatAmp: 0.5 + Math.random(),
      startY: mesh.position.y,
    };
    scene.add(mesh);
    shapes.push(mesh);
  }

  // Sparkle particles
  const sparkleGeo = new THREE.BufferGeometry();
  const sparkleCount = 100;
  const sparklePos = new Float32Array(sparkleCount * 3);
  const sparkleVel = [];
  for (let i = 0; i < sparkleCount; i++) {
    sparklePos[i * 3] = (Math.random() - 0.5) * 60;
    sparklePos[i * 3 + 1] = (Math.random() - 0.5) * 60;
    sparklePos[i * 3 + 2] = (Math.random() - 0.5) * 30;
    sparkleVel.push({ x: (Math.random() - 0.5) * 0.02, y: Math.random() * 0.02 + 0.01, z: (Math.random() - 0.5) * 0.01 });
  }
  sparkleGeo.setAttribute('position', new THREE.BufferAttribute(sparklePos, 3));
  const sparkleMat = new THREE.PointsMaterial({ color: 0xfbbf24, size: 1, transparent: true, opacity: 0.4 });
  const sparkles = new THREE.Points(sparkleGeo, sparkleMat);
  scene.add(sparkles);

  let time = 0;
  function animate() {
    requestAnimationFrame(animate);
    time += 0.01;

    stars.rotation.y = time * 0.02;
    stars.rotation.x = Math.sin(time * 0.1) * 0.02;

    shapes.forEach(s => {
      s.rotation.x += s.userData.rotSpeed;
      s.rotation.y += s.userData.rotSpeed * 0.7;
      s.position.y = s.userData.startY + Math.sin(time * s.userData.floatSpeed) * s.userData.floatAmp;
    });

    const sPos = sparkleGeo.attributes.position.array;
    for (let i = 0; i < sparkleCount; i++) {
      sPos[i * 3] += sparkleVel[i].x;
      sPos[i * 3 + 1] += sparkleVel[i].y;
      sPos[i * 3 + 2] += sparkleVel[i].z;
      if (sPos[i * 3 + 1] > 30) {
        sPos[i * 3 + 1] = -30;
        sPos[i * 3] = (Math.random() - 0.5) * 60;
      }
    }
    sparkleGeo.attributes.position.needsUpdate = true;

    renderer.render(scene, camera);
  }
  animate();

  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
})();

// ========================================
// MINI THREE.JS SCENES FOR EACH STORY
// ========================================
function createMiniScene(containerId, setupFn) {
  const container = document.getElementById(containerId);
  if (!container) return null;
  const w = container.clientWidth - 48;
  const h = 300;
  const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setSize(w, h);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.domElement.style.borderRadius = '12px';
  container.insertBefore(renderer.domElement, container.firstChild);

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(50, w / h, 0.1, 100);

  const ctx = { renderer, scene, camera, container, w, h };
  setupFn(ctx);
  return ctx;
}

// Scene 1: Backpack with floating pouches
let scene1Objs = [];
createMiniScene('scene-1', (ctx) => {
  ctx.camera.position.set(0, 0, 8);
  
  // Ambient light
  ctx.scene.add(new THREE.AmbientLight(0x8b5cf6, 0.5));
  const light = new THREE.PointLight(0xfbbf24, 1, 20);
  light.position.set(3, 3, 5);
  ctx.scene.add(light);

  // Backpack body
  const backpack = new THREE.Mesh(
    new THREE.BoxGeometry(2.5, 3, 1.5),
    new THREE.MeshPhongMaterial({ color: 0x8b5cf6, transparent: true, opacity: 0.7, shininess: 80 })
  );
  backpack.position.y = -0.5;
  ctx.scene.add(backpack);
  scene1Objs.push(backpack);

  // Straps
  [-0.7, 0.7].forEach(x => {
    const strap = new THREE.Mesh(
      new THREE.BoxGeometry(0.15, 2, 0.1),
      new THREE.MeshPhongMaterial({ color: 0x6d28d9 })
    );
    strap.position.set(x, 0.8, 0.8);
    ctx.scene.add(strap);
  });

  // Pouches
  const pouchData = [
    { label: 'name', x: -1.8, y: 1.2, color: 0xfbbf24 },
    { label: 'age', x: 0, y: 1.8, color: 0x06b6d4 },
    { label: 'snack', x: 1.8, y: 1.2, color: 0x10b981 },
    { label: 'has_map', x: -1.2, y: -0.5, color: 0xec4899 },
    { label: 'coins', x: 1.2, y: -0.5, color: 0xf97316 },
  ];
  pouchData.forEach((p, i) => {
    const pouch = new THREE.Mesh(
      new THREE.SphereGeometry(0.4, 16, 16),
      new THREE.MeshPhongMaterial({ color: p.color, transparent: true, opacity: 0.8, shininess: 100 })
    );
    pouch.position.set(p.x, p.y, 1);
    pouch.userData = { startY: p.y, phase: i * 0.8 };
    ctx.scene.add(pouch);
    scene1Objs.push(pouch);
  });

  // Particles
  const particleGeo = new THREE.BufferGeometry();
  const pCount = 50;
  const pPos = new Float32Array(pCount * 3);
  for (let i = 0; i < pCount; i++) {
    pPos[i * 3] = (Math.random() - 0.5) * 8;
    pPos[i * 3 + 1] = (Math.random() - 0.5) * 6;
    pPos[i * 3 + 2] = (Math.random() - 0.5) * 4;
  }
  particleGeo.setAttribute('position', new THREE.BufferAttribute(pPos, 3));
  const particleMat = new THREE.PointsMaterial({ color: 0xfbbf24, size: 0.08, transparent: true, opacity: 0.6 });
  ctx.scene.add(new THREE.Points(particleGeo, particleMat));

  let t = 0;
  function anim() {
    requestAnimationFrame(anim);
    t += 0.015;
    scene1Objs.forEach((obj, i) => {
      if (i === 0) {
        obj.rotation.y = Math.sin(t * 0.3) * 0.1;
      } else {
        obj.position.y = obj.userData.startY + Math.sin(t + obj.userData.phase) * 0.15;
        obj.rotation.y = t * 0.5;
      }
    });
    ctx.renderer.render(ctx.scene, ctx.camera);
  }
  anim();
});

// Scene 2: Dragon's cave
createMiniScene('scene-2', (ctx) => {
  ctx.camera.position.set(0, 0, 10);

  ctx.scene.add(new THREE.AmbientLight(0xff6666, 0.3));
  const fireLight = new THREE.PointLight(0xff4444, 1.5, 15);
  fireLight.position.set(0, -1, 3);
  ctx.scene.add(fireLight);
  
  // Cave opening (torus)
  const cave = new THREE.Mesh(
    new THREE.TorusGeometry(2.5, 0.5, 8, 32),
    new THREE.MeshPhongMaterial({ color: 0x444444, shininess: 20 })
  );
  cave.position.z = -1;
  ctx.scene.add(cave);

  // Dragon body (cone)
  const body = new THREE.Mesh(
    new THREE.ConeGeometry(1.2, 2.5, 6),
    new THREE.MeshPhongMaterial({ color: 0xef4444, shininess: 60 })
  );
  body.position.set(0, -0.5, 1);
  ctx.scene.add(body);
  
  // Dragon head
  const head = new THREE.Mesh(
    new THREE.SphereGeometry(0.6, 8, 8),
    new THREE.MeshPhongMaterial({ color: 0xdc2626 })
  );
  head.position.set(0, 1.2, 1.2);
  ctx.scene.add(head);
  
  // Eyes
  [-0.2, 0.2].forEach(x => {
    const eye = new THREE.Mesh(
      new THREE.SphereGeometry(0.12, 8, 8),
      new THREE.MeshPhongMaterial({ color: 0xfbbf24, emissive: 0xfbbf24, emissiveIntensity: 0.5 })
    );
    eye.position.set(x, 1.35, 1.7);
    ctx.scene.add(eye);
  });

  // Fire particles
  const fireGeo = new THREE.BufferGeometry();
  const fCount = 30;
  const fPos = new Float32Array(fCount * 3);
  const fVel = [];
  for (let i = 0; i < fCount; i++) {
    fPos[i * 3] = (Math.random() - 0.5) * 2;
    fPos[i * 3 + 1] = -2 + Math.random() * 2;
    fPos[i * 3 + 2] = Math.random() * 2;
    fVel.push(Math.random() * 0.03 + 0.01);
  }
  fireGeo.setAttribute('position', new THREE.BufferAttribute(fPos, 3));
  const fireMat = new THREE.PointsMaterial({ color: 0xff6600, size: 0.15, transparent: true, opacity: 0.6 });
  const fire = new THREE.Points(fireGeo, fireMat);
  ctx.scene.add(fire);

  let t = 0;
  function anim() {
    requestAnimationFrame(anim);
    t += 0.02;
    head.position.y = 1.2 + Math.sin(t) * 0.1;
    head.rotation.z = Math.sin(t * 0.7) * 0.1;
    body.rotation.y = Math.sin(t * 0.3) * 0.05;
    fireLight.intensity = 1 + Math.sin(t * 3) * 0.5;
    
    const fp = fireGeo.attributes.position.array;
    for (let i = 0; i < fCount; i++) {
      fp[i * 3 + 1] += fVel[i];
      if (fp[i * 3 + 1] > 2) {
        fp[i * 3 + 1] = -2;
        fp[i * 3] = (Math.random() - 0.5) * 2;
      }
    }
    fireGeo.attributes.position.needsUpdate = true;
    ctx.renderer.render(ctx.scene, ctx.camera);
  }
  anim();
});

// Scene 3: Wizard with stars
createMiniScene('scene-3', (ctx) => {
  ctx.camera.position.set(0, 0, 10);
  ctx.scene.add(new THREE.AmbientLight(0x06b6d4, 0.3));
  const magicLight = new THREE.PointLight(0x06b6d4, 1, 15);
  magicLight.position.set(0, 2, 5);
  ctx.scene.add(magicLight);

  // Wizard (cone body + sphere head)
  const wizBody = new THREE.Mesh(
    new THREE.ConeGeometry(1, 2.5, 8),
    new THREE.MeshPhongMaterial({ color: 0x3b82f6 })
  );
  wizBody.position.set(-2, -1.5, 0);
  ctx.scene.add(wizBody);

  const wizHead = new THREE.Mesh(
    new THREE.SphereGeometry(0.5, 8, 8),
    new THREE.MeshPhongMaterial({ color: 0xfcd34d })
  );
  wizHead.position.set(-2, 0.3, 0);
  ctx.scene.add(wizHead);

  // Wizard hat
  const hat = new THREE.Mesh(
    new THREE.ConeGeometry(0.6, 1.2, 8),
    new THREE.MeshPhongMaterial({ color: 0x1d4ed8 })
  );
  hat.position.set(-2, 1.2, 0);
  ctx.scene.add(hat);

  // Wand
  const wand = new THREE.Mesh(
    new THREE.CylinderGeometry(0.04, 0.04, 1.5, 8),
    new THREE.MeshPhongMaterial({ color: 0xfbbf24, emissive: 0xfbbf24, emissiveIntensity: 0.3 })
  );
  wand.position.set(-1, 0, 0.5);
  wand.rotation.z = -0.5;
  ctx.scene.add(wand);

  // Stars
  const starMeshes = [];
  for (let i = 0; i < 5; i++) {
    const star = new THREE.Mesh(
      new THREE.OctahedronGeometry(0.3, 0),
      new THREE.MeshPhongMaterial({ color: 0xfbbf24, transparent: true, opacity: 0.2, emissive: 0xfbbf24, emissiveIntensity: 0 })
    );
    const angle = (i / 5) * Math.PI * 1.2 - 0.3;
    star.position.set(Math.cos(angle) * 3 + 1, Math.sin(angle) * 2 + 1, 0);
    star.userData = { baseOpacity: 0.2, phase: i * 0.5 };
    ctx.scene.add(star);
    starMeshes.push(star);
  }

  // Magic particles
  const mGeo = new THREE.BufferGeometry();
  const mCount = 40;
  const mPos = new Float32Array(mCount * 3);
  for (let i = 0; i < mCount; i++) {
    mPos[i * 3] = (Math.random() - 0.5) * 8;
    mPos[i * 3 + 1] = (Math.random() - 0.5) * 6;
    mPos[i * 3 + 2] = (Math.random() - 0.5) * 4;
  }
  mGeo.setAttribute('position', new THREE.BufferAttribute(mPos, 3));
  ctx.scene.add(new THREE.Points(mGeo, new THREE.PointsMaterial({ color: 0x06b6d4, size: 0.08, transparent: true, opacity: 0.5 })));

  let t = 0;
  window._scene3Stars = starMeshes;
  function anim() {
    requestAnimationFrame(anim);
    t += 0.015;
    wand.rotation.z = -0.5 + Math.sin(t * 2) * 0.15;
    starMeshes.forEach((s, i) => {
      s.rotation.y = t;
      s.position.y += Math.sin(t + s.userData.phase) * 0.002;
    });
    magicLight.intensity = 1 + Math.sin(t * 2) * 0.3;
    ctx.renderer.render(ctx.scene, ctx.camera);
  }
  anim();
});

// Scene 4: Kitchen with cauldron
createMiniScene('scene-4', (ctx) => {
  ctx.camera.position.set(0, 0, 10);
  ctx.scene.add(new THREE.AmbientLight(0x10b981, 0.3));
  const potLight = new THREE.PointLight(0x10b981, 1.2, 15);
  potLight.position.set(0, 0, 5);
  ctx.scene.add(potLight);

  // Chef Maya (cone + sphere)
  const chefBody = new THREE.Mesh(
    new THREE.ConeGeometry(0.8, 2, 8),
    new THREE.MeshPhongMaterial({ color: 0x10b981 })
  );
  chefBody.position.set(-2.5, -1.5, 0);
  ctx.scene.add(chefBody);

  const chefHead = new THREE.Mesh(
    new THREE.SphereGeometry(0.4, 8, 8),
    new THREE.MeshPhongMaterial({ color: 0xfcd34d })
  );
  chefHead.position.set(-2.5, 0, 0);
  ctx.scene.add(chefHead);

  // Chef hat
  const chefHat = new THREE.Mesh(
    new THREE.CylinderGeometry(0.35, 0.4, 0.7, 8),
    new THREE.MeshPhongMaterial({ color: 0xffffff })
  );
  chefHat.position.set(-2.5, 0.7, 0);
  ctx.scene.add(chefHat);

  // Cauldron
  const cauldron = new THREE.Mesh(
    new THREE.SphereGeometry(1.5, 16, 12, 0, Math.PI * 2, 0, Math.PI * 0.7),
    new THREE.MeshPhongMaterial({ color: 0x333333, side: THREE.DoubleSide })
  );
  cauldron.position.set(1, -1.5, 0);
  cauldron.rotation.x = Math.PI;
  ctx.scene.add(cauldron);

  // Bubbling liquid
  const liquid = new THREE.Mesh(
    new THREE.CircleGeometry(1.2, 16),
    new THREE.MeshPhongMaterial({ color: 0x10b981, transparent: true, opacity: 0.6, emissive: 0x10b981, emissiveIntensity: 0.3 })
  );
  liquid.position.set(1, -0.3, 0);
  liquid.rotation.x = -Math.PI / 2;
  ctx.scene.add(liquid);

  // Bubbles
  const bubbleObjs = [];
  for (let i = 0; i < 8; i++) {
    const bubble = new THREE.Mesh(
      new THREE.SphereGeometry(0.1 + Math.random() * 0.1, 8, 8),
      new THREE.MeshPhongMaterial({ color: 0x34d399, transparent: true, opacity: 0.5 })
    );
    bubble.position.set(1 + (Math.random() - 0.5) * 1.5, -0.2, (Math.random() - 0.5));
    bubble.userData = { startY: bubble.position.y, speed: 0.5 + Math.random() };
    ctx.scene.add(bubble);
    bubbleObjs.push(bubble);
  }

  // Ingredient bottles
  const bottleColors = [0xfbbf24, 0xef4444, 0x8b5cf6, 0x06b6d4];
  bottleColors.forEach((c, i) => {
    const bottle = new THREE.Mesh(
      new THREE.CylinderGeometry(0.15, 0.2, 0.6, 8),
      new THREE.MeshPhongMaterial({ color: c, transparent: true, opacity: 0.7 })
    );
    bottle.position.set(-1 + i * 0.7, -2.5, 1);
    ctx.scene.add(bottle);
  });

  let t = 0;
  function anim() {
    requestAnimationFrame(anim);
    t += 0.02;
    bubbleObjs.forEach(b => {
      b.position.y += 0.01 * b.userData.speed;
      b.position.x += Math.sin(t + b.userData.speed) * 0.003;
      if (b.position.y > 1.5) {
        b.position.y = b.userData.startY;
      }
    });
    potLight.intensity = 1.2 + Math.sin(t * 3) * 0.2;
    liquid.material.emissiveIntensity = 0.3 + Math.sin(t * 2) * 0.1;
    ctx.renderer.render(ctx.scene, ctx.camera);
  }
  anim();
});

// Scene 5: Toy box
createMiniScene('scene-5', (ctx) => {
  ctx.camera.position.set(0, 0, 10);
  ctx.scene.add(new THREE.AmbientLight(0xec4899, 0.3));
  const toyLight = new THREE.PointLight(0xec4899, 1, 15);
  toyLight.position.set(0, 2, 5);
  ctx.scene.add(toyLight);

  // Toy box
  const box = new THREE.Mesh(
    new THREE.BoxGeometry(5, 2.5, 2),
    new THREE.MeshPhongMaterial({ color: 0xec4899, transparent: true, opacity: 0.4 })
  );
  box.position.set(0, -1, 0);
  ctx.scene.add(box);

  // Box lid (open)
  const lid = new THREE.Mesh(
    new THREE.BoxGeometry(5, 0.2, 2),
    new THREE.MeshPhongMaterial({ color: 0xdb2777 })
  );
  lid.position.set(0, 0.5, -1);
  lid.rotation.x = -0.8;
  ctx.scene.add(lid);

  // Toys (geometric shapes)
  const toyShapes = [
    { geo: new THREE.SphereGeometry(0.4, 8, 8), color: 0xfbbf24, x: -1.5 },      // teddy
    { geo: new THREE.BoxGeometry(0.6, 0.8, 0.4), color: 0x94a3b8, x: 0 },        // robot
    { geo: new THREE.ConeGeometry(0.4, 0.8, 6), color: 0x22c55e, x: 1.5 },       // dragon
  ];
  const toyMeshes = [];
  toyShapes.forEach(ts => {
    const mesh = new THREE.Mesh(ts.geo, new THREE.MeshPhongMaterial({ color: ts.color, shininess: 80 }));
    mesh.position.set(ts.x, 0.3, 0);
    mesh.userData = { startY: 0.3, startX: ts.x };
    ctx.scene.add(mesh);
    toyMeshes.push(mesh);
  });

  // Sparkles
  const spGeo = new THREE.BufferGeometry();
  const spCount = 30;
  const spPos = new Float32Array(spCount * 3);
  for (let i = 0; i < spCount; i++) {
    spPos[i * 3] = (Math.random() - 0.5) * 6;
    spPos[i * 3 + 1] = Math.random() * 4 - 1;
    spPos[i * 3 + 2] = (Math.random() - 0.5) * 3;
  }
  spGeo.setAttribute('position', new THREE.BufferAttribute(spPos, 3));
  ctx.scene.add(new THREE.Points(spGeo, new THREE.PointsMaterial({ color: 0xfbbf24, size: 0.08, transparent: true, opacity: 0.5 })));

  // Index labels (small cubes)
  for (let i = 0; i < 3; i++) {
    const label = new THREE.Mesh(
      new THREE.BoxGeometry(0.3, 0.3, 0.1),
      new THREE.MeshPhongMaterial({ color: 0x06b6d4 })
    );
    label.position.set(-1.5 + i * 1.5, -1.8, 1.1);
    ctx.scene.add(label);
  }

  let t = 0;
  function anim() {
    requestAnimationFrame(anim);
    t += 0.015;
    toyMeshes.forEach((m, i) => {
      m.position.y = m.userData.startY + Math.sin(t + i) * 0.15;
      m.rotation.y = t * (0.3 + i * 0.1);
    });
    ctx.renderer.render(ctx.scene, ctx.camera);
  }
  anim();
});

// ========================================
// NAVIGATION
// ========================================
function goToStory(index) {
  currentStory = index;
  document.querySelectorAll('.story-page').forEach((p, i) => {
    p.classList.toggle('active', i === index);
  });
  document.querySelectorAll('.chapter-btn').forEach((b, i) => {
    b.classList.toggle('active', i === index);
  });
  document.querySelectorAll('.nav-dot').forEach((d, i) => {
    d.classList.toggle('active', i === index);
  });
  document.getElementById('nav-prev').classList.toggle('disabled', index === 0);
  document.getElementById('nav-next').classList.toggle('disabled', index === totalStories - 1);
  window.scrollTo({ top: document.getElementById('chapters').offsetTop - 20, behavior: 'smooth' });
}

function prevStory() { if (currentStory > 0) goToStory(currentStory - 1); }
function nextStory() { if (currentStory < totalStories - 1) goToStory(currentStory + 1); }

// ========================================
// STORY 1: MAGIC BACKPACK INTERACTIONS
// ========================================
function openPouch(el, name, value, emoji) {
  if (el.classList.contains('open')) return;
  el.classList.add('open');
  el.querySelector('.pouch-icon').textContent = emoji;
  document.getElementById('var-output').innerHTML = `<span style="color:var(--purple)">${name}</span> = <span style="color:var(--green)">${value}</span> âœ¨`;
}

function packItem(el, itemText) {
  if (el.classList.contains('placed')) return;
  el.classList.add('placed');
  packedItems.push(itemText);
  const zone = document.getElementById('drop-zone');
  const name = itemText.split(' ')[1];
  zone.innerHTML = packedItems.map(it => {
    const n = it.split(' ')[1];
    return `<span class="placed-item">${n} = "${it}"</span>`;
  }).join('');
  document.getElementById('pack-output').innerHTML = `ğŸ’ Packed! <span style="color:var(--purple)">${name}</span> = <span style="color:var(--green)">"${itemText}"</span>`;
}

// ========================================
// STORY 2: DRAGON'S RIDDLE INTERACTIONS
// ========================================
function answerRiddle(btn, answer) {
  const result = document.getElementById('riddle-result');
  const btns = document.querySelectorAll('#riddle-choices .choice-btn');
  btns.forEach(b => b.classList.remove('correct', 'wrong', 'almost'));

  if (answer === 'friendship') {
    btn.classList.add('correct');
    result.innerHTML = 'âœ… <strong>if password == "friendship":</strong> âœ¨ The cave door opens with a golden glow! "Welcome, friend!" says the dragon. ğŸ‰ğŸ’›';
    result.style.background = 'rgba(16,185,129,.1)';
    result.style.color = 'var(--green)';
  } else if (answer === 'friend') {
    btn.classList.add('almost');
    result.innerHTML = 'ğŸ¤” <strong>elif password == "friend":</strong> "So close! The magic word is longer..." hints the dragon.';
    result.style.background = 'rgba(249,115,22,.1)';
    result.style.color = 'var(--orange)';
  } else {
    btn.classList.add('wrong');
    result.innerHTML = 'âŒ <strong>else:</strong> "Nope! That\'s not the word. Think about what makes friends special..." ğŸ‰';
    result.style.background = 'rgba(239,68,68,.1)';
    result.style.color = 'var(--red)';
  }
  result.classList.add('show');
}

function answerRiddle2(btn, num) {
  const result = document.getElementById('riddle-result-2');
  const btns = document.querySelectorAll('#riddle-choices-2 .choice-btn');
  btns.forEach(b => b.classList.remove('correct', 'wrong', 'almost'));

  if (num > 7) {
    btn.classList.add('correct');
    result.innerHTML = `â­ <strong>if stars > 7:</strong> "Wow, ${num} stars! That's a lot! The sky is extra bright tonight!" ğŸŒŸâœ¨`;
    result.style.background = 'rgba(16,185,129,.1)';
    result.style.color = 'var(--green)';
  } else if (num === 7) {
    btn.classList.add('almost');
    result.innerHTML = `ğŸ¯ <strong>elif stars == 7:</strong> "Exactly 7! A lucky number!" says the dragon. ğŸ€`;
    result.style.background = 'rgba(249,115,22,.1)';
    result.style.color = 'var(--orange)';
  } else {
    btn.classList.add('wrong');
    result.innerHTML = `ğŸŒ™ <strong>else:</strong> "Only ${num}? The sky is a bit dim tonight..." ğŸ˜´`;
    result.style.background = 'rgba(239,68,68,.1)';
    result.style.color = 'var(--red)';
  }
  result.classList.add('show');
}

// ========================================
// STORY 3: WIZARD'S SPELL INTERACTIONS
// ========================================
async function castStarSpell() {
  if (starSpellRunning) return;
  starSpellRunning = true;
  resetStars();
  const log = document.getElementById('star-log');
  const counter = document.getElementById('loop-counter');

  for (let i = 0; i < 5; i++) {
    await sleep(500);
    const star = document.getElementById(`star-${i}`);
    star.classList.add('lit');
    counter.innerHTML = `for star in range(5): <span style="color:var(--cyan)">star = ${i}</span>`;
    log.innerHTML += `<div class="log-line"><span class="log-iter">star = ${i}</span> â†’ <span class="log-action">â­ Star ${i} is glowing!</span></div>`;
    log.scrollTop = log.scrollHeight;

    // Light up 3D scene stars too
    if (window._scene3Stars && window._scene3Stars[i]) {
      window._scene3Stars[i].material.opacity = 0.9;
      window._scene3Stars[i].material.emissiveIntensity = 0.5;
    }
  }
  counter.innerHTML = 'ğŸ‰ Loop complete! All 5 stars are lit!';
  starSpellRunning = false;
}

function resetStars() {
  for (let i = 0; i < 5; i++) {
    document.getElementById(`star-${i}`).classList.remove('lit');
    if (window._scene3Stars && window._scene3Stars[i]) {
      window._scene3Stars[i].material.opacity = 0.2;
      window._scene3Stars[i].material.emissiveIntensity = 0;
    }
  }
  document.getElementById('star-log').innerHTML = '';
  document.getElementById('loop-counter').textContent = 'Ready to cast!';
}

async function fightDragons() {
  if (dragonFightRunning) return;
  dragonFightRunning = true;
  resetDragons();
  const log = document.getElementById('dragon-log');
  const counter = document.getElementById('dragon-counter');
  let dragons = 3;

  // Light them up first
  for (let i = 0; i < 3; i++) {
    document.getElementById(`dragon-${i}`).classList.add('lit');
  }
  await sleep(400);

  while (dragons > 0) {
    await sleep(700);
    dragons--;
    document.getElementById(`dragon-${2 - dragons}`).classList.remove('lit');
    counter.innerHTML = `while dragons > 0: <span style="color:var(--cyan)">dragons = ${dragons}</span>`;
    log.innerHTML += `<div class="log-line"><span class="log-iter">dragons = ${dragons + 1} â†’ ${dragons}</span> â†’ <span class="log-action">âš”ï¸ Dragon defeated!</span></div>`;
    log.scrollTop = log.scrollHeight;
  }
  counter.innerHTML = 'ğŸ‰ All dragons defeated! while loop ended.';
  dragonFightRunning = false;
}

function resetDragons() {
  for (let i = 0; i < 3; i++) {
    document.getElementById(`dragon-${i}`).classList.remove('lit');
  }
  document.getElementById('dragon-log').innerHTML = '';
  document.getElementById('dragon-counter').textContent = 'dragons = 3';
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

// ========================================
// STORY 4: RECIPE BOOK INTERACTIONS
// ========================================
function selectIngredient(el, name) {
  document.querySelectorAll('.ingredient').forEach(i => i.classList.remove('selected'));
  el.classList.add('selected');
  selectedIngredient = name;
  const cleanName = name.split(' ')[1];
  document.getElementById('recipe-live').innerHTML = `<span class="kw">def</span> <span class="fn">make_potion</span>(<span class="fn">ingredient</span>):\n    potion = "magical " + ingredient + " potion"\n    <span class="kw">return</span> potion\n\n<span class="active-line">result = make_potion("${cleanName}")  # â† calling!</span>`;
}

function brewPotion() {
  if (!selectedIngredient) {
    document.getElementById('recipe-result').innerHTML = 'ğŸ‘† Pick an ingredient first!';
    document.getElementById('recipe-result').style.color = 'var(--text-dim)';
    return;
  }
  const cauldron = document.getElementById('cauldron');
  const cleanName = selectedIngredient.split(' ')[1];
  const emoji = selectedIngredient.split(' ')[0];
  cauldron.classList.add('brewing');
  cauldron.textContent = emoji;

  setTimeout(() => {
    cauldron.classList.remove('brewing');
    cauldron.textContent = 'âœ¨';
    document.getElementById('recipe-result').innerHTML = `${emoji} <strong>Magical ${cleanName} potion</strong> brewed! â†’ return "magical ${cleanName} potion"`;
    document.getElementById('recipe-result').style.color = 'var(--gold)';
    document.getElementById('recipe-live').innerHTML = `<span class="kw">def</span> <span class="fn">make_potion</span>(<span class="fn">"${cleanName}"</span>):\n    potion = "magical ${cleanName} potion"\n    <span class="kw">return</span> <span class="active-line">"magical ${cleanName} potion"  âœ¨</span>`;
  }, 1000);
}

// ========================================
// STORY 5: TOY BOX INTERACTIONS
// ========================================
function renderToyBox() {
  const box = document.getElementById('toybox');
  const display = document.getElementById('toy-list-code');
  if (toyList.length === 0) {
    box.innerHTML = '<span style="color:var(--text-dim)">Empty toy box! Add some toys.</span>';
  } else {
    box.innerHTML = toyList.map((t, i) => `
      <div class="toy-slot" onclick="highlightToy(${i})">
        <div class="toy-emoji">${t.split(' ')[0]}</div>
        <div class="toy-index">[${i}]</div>
      </div>
    `).join('');
  }
  display.textContent = `toys = [${toyList.map(t => `"${t}"`).join(', ')}]`;
}

function highlightToy(i) {
  document.getElementById('toy-output').innerHTML = `toys[<span style="color:var(--purple)">${i}</span>] = "<span style="color:var(--green)">${toyList[i]}</span>"`;
}

function addToy() {
  const input = document.getElementById('toy-input');
  const val = input.value.trim();
  if (!val) return;
  toyList.push(val);
  input.value = '';
  renderToyBox();
  document.getElementById('toy-output').innerHTML = `toys.append("<span style="color:var(--green)">${val}</span>") â†’ len = ${toyList.length}`;
}

function removeToy() {
  const input = document.getElementById('toy-input');
  const val = input.value.trim();
  if (!val) { document.getElementById('toy-output').innerHTML = 'Type a toy name to remove!'; return; }
  const idx = toyList.indexOf(val);
  if (idx === -1) { document.getElementById('toy-output').innerHTML = `âŒ "${val}" not found in the list!`; return; }
  toyList.splice(idx, 1);
  input.value = '';
  renderToyBox();
  document.getElementById('toy-output').innerHTML = `toys.remove("<span style="color:var(--red)">${val}</span>") â†’ len = ${toyList.length}`;
}

function popToy() {
  if (toyList.length === 0) { document.getElementById('toy-output').innerHTML = 'âŒ Toy box is empty!'; return; }
  const popped = toyList.pop();
  renderToyBox();
  document.getElementById('toy-output').innerHTML = `toys.pop() â†’ removed "<span style="color:var(--red)">${popped}</span>" from end`;
}

function getToy() {
  const idx = parseInt(document.getElementById('toy-index').value);
  if (isNaN(idx)) { document.getElementById('toy-output').innerHTML = 'Enter an index number!'; return; }
  if (idx < 0 || idx >= toyList.length) {
    document.getElementById('toy-output').innerHTML = `âŒ IndexError! Valid range: 0 to ${toyList.length - 1}`;
    return;
  }
  document.getElementById('toy-output').innerHTML = `toys[<span style="color:var(--purple)">${idx}</span>] = "<span style="color:var(--green)">${toyList[idx]}</span>"`;
}

function toyLen() {
  document.getElementById('toy-output').innerHTML = `len(toys) = <span style="color:var(--cyan)">${toyList.length}</span>`;
}

function resetToys() {
  toyList = ['ğŸ§¸ teddy', 'ğŸ¤– robot', 'ğŸ‰ dragon'];
  renderToyBox();
  document.getElementById('toy-output').innerHTML = 'Toy box reset! ğŸ”„';
}

// ========================================
// SPARKLE CURSOR EFFECT
// ========================================
document.addEventListener('click', (e) => {
  const sparkles = ['âœ¨', 'â­', 'ğŸ’«', 'ğŸŒŸ'];
  for (let i = 0; i < 3; i++) {
    const s = document.createElement('div');
    s.className = 'sparkle';
    s.textContent = sparkles[Math.floor(Math.random() * sparkles.length)];
    s.style.left = (e.clientX + (Math.random() - 0.5) * 30) + 'px';
    s.style.top = (e.clientY + (Math.random() - 0.5) * 30) + 'px';
    document.body.appendChild(s);
    setTimeout(() => s.remove(), 1000);
  }
});

// ========================================
// KEYBOARD NAVIGATION
// ========================================
document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowLeft') prevStory();
  if (e.key === 'ArrowRight') nextStory();
});

// ========================================
// INIT
// ========================================
renderToyBox();
goToStory(0);

// Remove loader
window.addEventListener('load', () => {
  setTimeout(() => {
    document.getElementById('loader').classList.add('hidden');
  }, 1500);
});
</script>
</body>
</html>
