<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Python Adventures ‚Äî Learn Python Through Magical Stories</title>
<meta name="description" content="A magical storybook where kids learn Python through interactive stories with beautiful infographics">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üêç</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0a0a2e;--bg2:#12123a;--gold:#fbbf24;--purple:#8b5cf6;--green:#10b981;
  --pink:#ec4899;--cyan:#06b6d4;--red:#ef4444;--orange:#f97316;
  --text:#e2e8f0;--text-dim:#94a3b8;--text-bright:#f8fafc;
}
html{scroll-behavior:smooth}
body{font-family:'Fredoka',sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;min-height:100vh}
::selection{background:var(--purple);color:white}
::-webkit-scrollbar{width:8px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--purple);border-radius:4px}

/* ===== THREE.JS CANVAS ===== */
#three-canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;opacity:0.4}
#app{position:relative;z-index:1}

/* ===== LOADING SCREEN ===== */
#loader{position:fixed;inset:0;z-index:9999;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .6s,visibility .6s}
#loader.hidden{opacity:0;visibility:hidden;pointer-events:none}
.loader-book{font-size:72px;animation:bookBounce 1s ease-in-out infinite}
.loader-text{margin-top:20px;font-size:20px;color:var(--gold);font-weight:500}
.loader-bar{width:200px;height:4px;background:rgba(255,255,255,.1);border-radius:4px;margin-top:16px;overflow:hidden}
.loader-fill{height:100%;background:linear-gradient(90deg,var(--purple),var(--cyan));border-radius:4px;animation:loadFill 1.5s ease-out forwards}
@keyframes bookBounce{0%,100%{transform:translateY(0) rotate(0)}50%{transform:translateY(-20px) rotate(5deg)}}
@keyframes loadFill{0%{width:0}100%{width:100%}}

/* ===== HERO ===== */
.hero{text-align:center;padding:80px 24px 40px;position:relative;max-width:800px;margin:0 auto}
.hero h1{font-size:clamp(40px,8vw,80px);font-weight:700;line-height:1.1;margin-bottom:12px}
.hero h1 .magic{background:linear-gradient(135deg,var(--gold),var(--pink),var(--purple),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;color:transparent;background-size:300% 300%;animation:gradientShift 4s ease infinite}
@keyframes gradientShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
.hero-sub{font-size:clamp(16px,2.5vw,20px);color:var(--text-dim);max-width:560px;margin:0 auto 24px;line-height:1.6;font-weight:300}
.hero-badge{display:inline-flex;align-items:center;gap:8px;background:rgba(139,92,246,.12);border:1px solid rgba(139,92,246,.25);border-radius:999px;padding:8px 20px;font-size:14px;color:var(--purple);margin-bottom:20px;backdrop-filter:blur(8px)}

/* ===== HOMEPAGE: STORY CARDS GRID ===== */
.home-section{max-width:1100px;margin:0 auto;padding:0 20px 60px}
.home-section h2{text-align:center;font-size:24px;color:var(--gold);margin-bottom:32px;font-weight:500}
.story-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:24px}
.story-card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:20px;overflow:hidden;cursor:pointer;transition:all .4s cubic-bezier(.25,.8,.25,1);position:relative}
.story-card:hover{transform:translateY(-6px);border-color:rgba(255,255,255,.18);box-shadow:0 20px 60px rgba(0,0,0,.4)}
.story-card-img{width:100%;aspect-ratio:16/9;object-fit:cover;display:block;transition:transform .4s}
.story-card:hover .story-card-img{transform:scale(1.03)}
.story-card-body{padding:20px}
.story-card-chapter{font-size:11px;text-transform:uppercase;letter-spacing:2px;opacity:.5;margin-bottom:4px}
.story-card-title{font-size:22px;font-weight:600;margin-bottom:6px}
.story-card-concept{font-size:13px;padding:4px 12px;border-radius:999px;display:inline-block;margin-bottom:8px;font-weight:500}
.story-card-desc{font-size:14px;color:var(--text-dim);line-height:1.6}
.story-card-arrow{position:absolute;bottom:20px;right:20px;width:36px;height:36px;border-radius:50%;border:1px solid rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;transition:all .3s;font-size:16px}
.story-card:hover .story-card-arrow{background:rgba(255,255,255,.1);border-color:rgba(255,255,255,.2)}

/* ===== STORY PAGE VIEW ===== */
.story-view{display:none;max-width:900px;margin:0 auto;padding:0 20px 60px}
.story-view.active{display:block;animation:fadeUp .5s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}

/* Back button */
.back-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 20px;border-radius:12px;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.04);color:var(--text);font-family:inherit;font-size:14px;cursor:pointer;transition:all .3s;margin-bottom:24px;font-weight:500;backdrop-filter:blur(8px)}
.back-btn:hover{border-color:rgba(255,255,255,.2);background:rgba(255,255,255,.08)}

/* Story header */
.story-header{text-align:center;margin-bottom:32px}
.story-chapter{font-size:12px;text-transform:uppercase;letter-spacing:3px;color:var(--text-dim);margin-bottom:6px}
.story-title{font-size:clamp(28px,5vw,44px);font-weight:700;margin-bottom:12px}
.story-concept{font-size:15px;font-weight:500;padding:6px 18px;border-radius:999px;display:inline-block;margin-bottom:16px}
.character-badge{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;border-radius:12px;font-size:14px;margin-bottom:12px;font-weight:500}

/* Infographic Image - Hero of each story */
.story-infographic{width:100%;border-radius:16px;margin-bottom:32px;border:2px solid rgba(255,255,255,.08);box-shadow:0 8px 40px rgba(0,0,0,.4);cursor:pointer;transition:all .3s}
.story-infographic:hover{border-color:rgba(255,255,255,.15);box-shadow:0 12px 50px rgba(0,0,0,.5)}

/* Story narration */
.story-narration{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:24px;margin-bottom:24px;font-size:17px;line-height:1.8}
.story-narration .highlight{color:var(--gold);font-weight:600}
.story-narration .code-inline{font-family:'Fira Code',monospace;background:rgba(139,92,246,.15);color:var(--purple);padding:2px 8px;border-radius:6px;font-size:14px}

/* Code Scroll */
.code-scroll{background:linear-gradient(135deg,rgba(20,20,60,.9),rgba(30,20,50,.9));border:1px solid rgba(139,92,246,.2);border-radius:16px;padding:24px;position:relative;overflow:hidden;margin-bottom:24px}
.code-scroll::before{content:'üìú Magic Scroll';position:absolute;top:0;left:0;right:0;padding:8px 16px;background:rgba(139,92,246,.15);font-size:12px;letter-spacing:1px;text-transform:uppercase;color:var(--purple)}
.code-scroll pre{margin-top:28px;font-family:'Fira Code',monospace;font-size:14px;line-height:1.8;overflow-x:auto;color:#e2e8f0}
.code-scroll .kw{color:var(--purple);font-weight:500}
.code-scroll .str{color:var(--green)}
.code-scroll .num{color:var(--cyan)}
.code-scroll .fn{color:var(--gold)}
.code-scroll .cm{color:var(--text-dim);font-style:italic}
.code-scroll .op{color:var(--pink)}
.code-scroll .bi{color:var(--orange)}

/* Interactive Section */
.interactive-section{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:24px;margin-bottom:24px}
.interactive-section h3{font-size:20px;margin-bottom:14px;display:flex;align-items:center;gap:10px}
.interactive-section h3 .emoji{font-size:24px}

/* Buttons */
.btn{padding:12px 24px;border-radius:12px;border:none;font-family:inherit;font-size:15px;font-weight:600;cursor:pointer;transition:all .3s;display:inline-flex;align-items:center;gap:8px}
.btn-primary{background:var(--purple);color:white}
.btn-primary:hover{background:#7c3aed;transform:translateY(-2px);box-shadow:0 8px 25px rgba(139,92,246,.3)}
.btn-gold{background:var(--gold);color:#0a0a2e}
.btn-gold:hover{background:#f59e0b;transform:translateY(-2px)}
.btn-outline{background:transparent;border:2px solid rgba(255,255,255,.15);color:var(--text)}
.btn-outline:hover{border-color:rgba(255,255,255,.3);background:rgba(255,255,255,.05)}
.btn-sm{padding:8px 16px;font-size:13px;border-radius:8px}

/* Fun Fact */
.fun-fact{background:linear-gradient(135deg,rgba(251,191,36,.08),rgba(251,191,36,.03));border:1px solid rgba(251,191,36,.2);border-radius:16px;padding:20px;display:flex;gap:12px;align-items:flex-start;margin-bottom:24px}
.fun-fact .ff-icon{font-size:24px;flex-shrink:0}
.fun-fact .ff-title{font-size:13px;text-transform:uppercase;letter-spacing:1px;color:var(--gold);margin-bottom:4px;font-weight:600}
.fun-fact .ff-text{font-size:14px;color:var(--text-dim);line-height:1.6}

/* ===== INTERACTIVE ELEMENTS ===== */

/* Story 1: Magic Backpack */
.backpack-zone{display:flex;flex-wrap:wrap;gap:16px;justify-content:center;margin:20px 0}
.pouch{width:130px;height:95px;background:linear-gradient(135deg,rgba(139,92,246,.2),rgba(139,92,246,.05));border:2px solid rgba(139,92,246,.3);border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;transition:all .3s;position:relative}
.pouch:hover{transform:scale(1.05);border-color:var(--purple);box-shadow:0 8px 30px rgba(139,92,246,.2)}
.pouch.open{background:linear-gradient(135deg,rgba(16,185,129,.15),rgba(16,185,129,.05));border-color:var(--green)}
.pouch .pouch-label{font-size:12px;color:var(--text-dim);font-family:'Fira Code',monospace;margin-bottom:4px}
.pouch .pouch-icon{font-size:28px;transition:transform .3s}
.pouch.open .pouch-icon{transform:scale(1.2)}
.pouch .pouch-value{font-size:13px;color:var(--green);font-family:'Fira Code',monospace;margin-top:4px;opacity:0;transition:opacity .3s}
.pouch.open .pouch-value{opacity:1}
.var-output{text-align:center;margin-top:16px;font-family:'Fira Code',monospace;font-size:15px;color:var(--gold);min-height:24px;transition:all .3s}

/* Story 2: Dragon's Riddle */
.dragon-scene{text-align:center;margin:20px 0}
.dragon-speech{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.2);border-radius:16px;padding:20px;margin:16px auto;max-width:500px;font-size:16px;line-height:1.6;position:relative}
.dragon-speech::after{content:'';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid rgba(239,68,68,.2)}
.choice-buttons{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin:16px 0}
.choice-btn{padding:12px 24px;border-radius:12px;border:2px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);color:var(--text);font-family:inherit;font-size:15px;cursor:pointer;transition:all .3s;min-width:140px}
.choice-btn:hover{border-color:rgba(255,255,255,.25);background:rgba(255,255,255,.08);transform:translateY(-2px)}
.choice-btn.correct{border-color:var(--green);background:rgba(16,185,129,.15);color:var(--green)}
.choice-btn.wrong{border-color:var(--red);background:rgba(239,68,68,.1);color:var(--red);animation:shake .4s}
.choice-btn.almost{border-color:var(--orange);background:rgba(249,115,22,.1);color:var(--orange)}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.riddle-result{margin-top:16px;padding:16px;border-radius:12px;font-size:15px;display:none}
.riddle-result.show{display:block;animation:fadeUp .3s}

/* Story 3: Wizard's Spells */
.stars-grid{display:flex;gap:16px;justify-content:center;flex-wrap:wrap;margin:20px 0}
.spell-star{width:56px;height:56px;display:flex;align-items:center;justify-content:center;font-size:28px;border-radius:50%;background:rgba(255,255,255,.03);border:2px solid rgba(255,255,255,.08);transition:all .5s;opacity:.3}
.spell-star.lit{opacity:1;background:rgba(251,191,36,.15);border-color:var(--gold);box-shadow:0 0 20px rgba(251,191,36,.3);transform:scale(1.1)}
.spell-controls{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin:16px 0}
.spell-log{font-family:'Fira Code',monospace;font-size:13px;color:var(--text-dim);max-height:120px;overflow-y:auto;padding:12px;background:rgba(0,0,0,.2);border-radius:12px;margin-top:12px;line-height:1.8}
.spell-log .log-line{animation:fadeUp .3s}
.spell-log .log-iter{color:var(--cyan)}
.spell-log .log-action{color:var(--gold)}
.loop-counter{text-align:center;font-size:20px;font-weight:700;color:var(--purple);margin:12px 0}

/* Story 4: Recipe Book */
.kitchen-area{text-align:center;margin:20px 0}
.ingredient-shelf{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin:16px 0}
.ingredient{padding:10px 20px;border-radius:12px;border:2px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);font-size:15px;cursor:pointer;transition:all .3s}
.ingredient:hover{border-color:rgba(255,255,255,.2);background:rgba(255,255,255,.06);transform:translateY(-2px)}
.ingredient.selected{border-color:var(--green);background:rgba(16,185,129,.1);color:var(--green)}
.cauldron{width:100px;height:100px;margin:16px auto;background:radial-gradient(circle,rgba(139,92,246,.2),rgba(139,92,246,.05));border:3px solid rgba(139,92,246,.3);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:40px;transition:all .5s;position:relative}
.cauldron.brewing{animation:brew 1s ease;border-color:var(--gold);box-shadow:0 0 40px rgba(251,191,36,.2)}
@keyframes brew{0%{transform:scale(1) rotate(0)}25%{transform:scale(1.1) rotate(-5deg)}50%{transform:scale(1.15) rotate(5deg)}75%{transform:scale(1.1) rotate(-3deg)}100%{transform:scale(1) rotate(0)}}
.recipe-result{font-size:18px;font-weight:600;color:var(--gold);margin:16px 0;min-height:28px;text-align:center}
.recipe-code-live{font-family:'Fira Code',monospace;font-size:14px;padding:16px;background:rgba(0,0,0,.2);border-radius:12px;text-align:left;margin:16px 0;color:var(--text-dim);line-height:1.8}
.recipe-code-live .active-line{color:var(--gold)}

/* Story 5: Toy Box */
.toybox{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:20px 0;min-height:80px;padding:16px;border:2px solid rgba(139,92,246,.2);border-radius:16px;background:rgba(139,92,246,.03);align-items:center}
.toy-slot{width:75px;height:75px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(255,255,255,.03);border:2px solid rgba(255,255,255,.08);border-radius:12px;transition:all .3s;cursor:pointer;gap:4px}
.toy-slot:hover{border-color:rgba(255,255,255,.2);transform:translateY(-2px)}
.toy-slot .toy-emoji{font-size:26px}
.toy-slot .toy-index{font-size:10px;font-family:'Fira Code',monospace;color:var(--text-dim)}
.toy-controls{display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin:16px 0;align-items:center}
.toy-input{padding:10px 16px;border-radius:10px;border:2px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);color:var(--text);font-family:inherit;font-size:14px;width:140px;outline:none;transition:border-color .3s}
.toy-input:focus{border-color:var(--purple)}
.toy-output{font-family:'Fira Code',monospace;font-size:14px;color:var(--cyan);text-align:center;margin:12px 0;min-height:22px}
.toy-list-display{font-family:'Fira Code',monospace;font-size:15px;text-align:center;margin:12px 0;padding:12px;background:rgba(0,0,0,.2);border-radius:12px;color:var(--green)}

/* ===== NAV ARROWS ===== */
.story-nav{display:flex;justify-content:space-between;align-items:center;padding:24px 0;margin-top:12px;border-top:1px solid rgba(255,255,255,.06)}
.nav-arrow{display:flex;align-items:center;gap:8px;padding:12px 20px;border-radius:12px;border:2px solid rgba(255,255,255,.1);background:rgba(255,255,255,.03);color:var(--text);font-family:inherit;font-size:14px;cursor:pointer;transition:all .3s;font-weight:500}
.nav-arrow:hover{border-color:rgba(255,255,255,.2);background:rgba(255,255,255,.06);transform:translateY(-2px)}
.nav-arrow.disabled{opacity:.3;pointer-events:none}
.nav-progress{display:flex;gap:6px}
.nav-dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.1);transition:all .3s;cursor:pointer}
.nav-dot.active{background:var(--purple);box-shadow:0 0 10px rgba(139,92,246,.4)}
.nav-dot.done{background:var(--green)}

/* ===== LIGHTBOX ===== */
.lightbox{position:fixed;inset:0;z-index:9998;background:rgba(0,0,0,.92);display:none;align-items:center;justify-content:center;padding:20px;cursor:zoom-out;backdrop-filter:blur(12px)}
.lightbox.active{display:flex}
.lightbox img{max-width:95vw;max-height:90vh;object-fit:contain;border-radius:12px;box-shadow:0 0 60px rgba(0,0,0,.6)}
.lightbox-close{position:absolute;top:20px;right:24px;width:44px;height:44px;border-radius:50%;border:1px solid rgba(255,255,255,.2);background:rgba(0,0,0,.5);color:white;font-size:22px;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:2}

/* ===== FOOTER ===== */
.site-footer{text-align:center;padding:40px 24px 60px;border-top:1px solid rgba(255,255,255,.06);color:var(--text-dim);font-size:14px}
.site-footer a{color:var(--purple);text-decoration:none}
.site-footer a:hover{text-decoration:underline}

/* ===== RESPONSIVE ===== */
@media(max-width:600px){
  .hero{padding:60px 16px 30px}
  .story-cards{grid-template-columns:1fr}
  .story-card-body{padding:16px}
  .pouch{width:100px;height:80px}
  .spell-star{width:44px;height:44px;font-size:20px}
  .toy-slot{width:60px;height:60px}
  .toy-slot .toy-emoji{font-size:20px}
  .code-scroll pre{font-size:12px}
  .choice-btn{min-width:120px;padding:10px 16px;font-size:14px}
  .story-narration{padding:18px;font-size:15px}
  .back-btn{padding:8px 14px;font-size:13px}
}

/* ===== SPARKLE CURSOR ===== */
.sparkle{position:fixed;pointer-events:none;z-index:9999;font-size:12px;animation:sparkleFloat 1s ease-out forwards}
@keyframes sparkleFloat{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-40px) scale(0)}}
</style>
</head>
<body>

<!-- Loading Screen -->
<div id="loader">
  <div class="loader-book">üìñ</div>
  <div class="loader-text">Opening your storybook...</div>
  <div class="loader-bar"><div class="loader-fill"></div></div>
</div>

<!-- Three.js Background -->
<canvas id="three-canvas"></canvas>

<!-- Lightbox for full-screen image view -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <button class="lightbox-close" onclick="closeLightbox()">‚úï</button>
  <img id="lightbox-img" src="" alt="Infographic">
</div>

<div id="app">

  <!-- ===================== HOMEPAGE ===================== -->
  <div id="homepage">
    <header class="hero">
      <div class="hero-badge">ü™Ñ 5 Magical Stories ‚Ä¢ 5 Python Concepts</div>
      <h1>Python<br><span class="magic">Adventures</span></h1>
      <p class="hero-sub">Learn Python through magical stories! Meet Luna, a friendly dragon, wizard Kai, chef Maya, and Zara ‚Äî each teaches you a Python superpower!</p>
    </header>

    <div class="home-section">
      <h2>‚ú® Choose Your Story ‚ú®</h2>
      <div class="story-cards">

        <div class="story-card" onclick="openStory(0)">
          <img class="story-card-img" src="images/variables-magic-backpack.jpg" alt="The Magic Backpack - Variables" loading="lazy">
          <div class="story-card-body">
            <div class="story-card-chapter">Chapter 1</div>
            <div class="story-card-title" style="color:var(--purple)">The Magic Backpack ‚ú®</div>
            <div class="story-card-concept" style="background:rgba(139,92,246,.1);color:var(--purple)">Variables</div>
            <div class="story-card-desc">Luna's magical backpack has special pouches ‚Äî each one holds a secret value, just like Python variables!</div>
          </div>
          <div class="story-card-arrow">‚Üí</div>
        </div>

        <div class="story-card" onclick="openStory(1)">
          <img class="story-card-img" src="images/ifelse-dragons-riddle.jpg" alt="The Dragon's Riddle - If/Else" loading="lazy">
          <div class="story-card-body">
            <div class="story-card-chapter">Chapter 2</div>
            <div class="story-card-title" style="color:var(--red)">The Dragon's Riddle üî•</div>
            <div class="story-card-concept" style="background:rgba(239,68,68,.1);color:var(--red)">If / Else</div>
            <div class="story-card-desc">A friendly dragon guards a magical cave. Answer riddles using if, elif, and else to unlock the door!</div>
          </div>
          <div class="story-card-arrow">‚Üí</div>
        </div>

        <div class="story-card" onclick="openStory(2)">
          <img class="story-card-img" src="images/loops-wizards-spell.jpg" alt="The Wizard's Spell - Loops" loading="lazy">
          <div class="story-card-body">
            <div class="story-card-chapter">Chapter 3</div>
            <div class="story-card-title" style="color:var(--cyan)">The Wizard's Spell üåü</div>
            <div class="story-card-concept" style="background:rgba(6,182,212,.1);color:var(--cyan)">Loops</div>
            <div class="story-card-desc">Wizard Kai learns spells that repeat! Light stars with for loops and battle dragons with while loops!</div>
          </div>
          <div class="story-card-arrow">‚Üí</div>
        </div>

        <div class="story-card" onclick="openStory(3)">
          <img class="story-card-img" src="images/functions-recipe-book.jpg" alt="The Recipe Book - Functions" loading="lazy">
          <div class="story-card-body">
            <div class="story-card-chapter">Chapter 4</div>
            <div class="story-card-title" style="color:var(--green)">The Recipe Book üß™</div>
            <div class="story-card-concept" style="background:rgba(16,185,129,.1);color:var(--green)">Functions</div>
            <div class="story-card-desc">Chef Maya's recipe book holds magical functions ‚Äî give ingredients, get a potion! Reusable magic!</div>
          </div>
          <div class="story-card-arrow">‚Üí</div>
        </div>

        <div class="story-card" onclick="openStory(4)">
          <img class="story-card-img" src="images/lists-toy-box.jpg" alt="The Magical Toy Box - Lists" loading="lazy">
          <div class="story-card-body">
            <div class="story-card-chapter">Chapter 5</div>
            <div class="story-card-title" style="color:var(--pink)">The Magical Toy Box üéÅ</div>
            <div class="story-card-concept" style="background:rgba(236,72,153,.1);color:var(--pink)">Lists</div>
            <div class="story-card-desc">Zara's enchanted toy box has numbered slots ‚Äî add, remove, and find toys just like Python lists!</div>
          </div>
          <div class="story-card-arrow">‚Üí</div>
        </div>

      </div>
    </div>
  </div>

  <!-- ===================== STORY PAGES ===================== -->

  <!-- STORY 1: THE MAGIC BACKPACK -->
  <div class="story-view" id="story-0">
    <button class="back-btn" onclick="goHome()">‚Üê Back to Stories</button>
    <div class="story-header">
      <div class="story-chapter">Chapter 1</div>
      <h2 class="story-title" style="color:var(--purple)">The Magic Backpack ‚ú®</h2>
      <div class="character-badge" style="background:rgba(139,92,246,.1);color:var(--purple)">üëß Meet Luna, the Young Explorer</div>
      <div class="story-concept" style="background:rgba(139,92,246,.1);color:var(--purple)">Python Concept: Variables</div>
    </div>

    <img class="story-infographic" src="images/variables-magic-backpack.jpg" alt="Variables - The Magic Backpack Infographic" onclick="openLightbox(this.src)">

    <div class="story-narration">
      <p>Luna found a <span class="highlight">magic backpack</span> in the forest! üå≤ It has special pouches with <strong>labels</strong>. When Luna writes a label and puts something inside, the backpack remembers it forever!</p>
      <p style="margin-top:12px">In Python, we call these <span class="highlight">variables</span>. A variable has a <strong>name</strong> (the label) and a <strong>value</strong> (what's inside).</p>
    </div>

    <div class="code-scroll">
      <pre><span class="cm"># Luna labels her pouches (creates variables!)</span>
<span class="fn">name</span> <span class="op">=</span> <span class="str">"Luna"</span>        <span class="cm"># A string (text)</span>
<span class="fn">age</span> <span class="op">=</span> <span class="num">10</span>             <span class="cm"># An integer (number)</span>
<span class="fn">snack</span> <span class="op">=</span> <span class="str">"cookies"</span>   <span class="cm"># Another string</span>
<span class="fn">has_map</span> <span class="op">=</span> <span class="kw">True</span>        <span class="cm"># A boolean (yes/no)</span>
<span class="fn">coins</span> <span class="op">=</span> <span class="num">3.5</span>           <span class="cm"># A float (decimal)</span>

<span class="cm"># Python remembers what's in each pouch!</span>
<span class="bi">print</span>(<span class="fn">name</span>)     <span class="cm"># Output: Luna</span>
<span class="bi">print</span>(<span class="fn">age</span>)      <span class="cm"># Output: 10</span></pre>
    </div>

    <div class="interactive-section">
      <h3><span class="emoji">üéí</span> Click Luna's Pouches!</h3>
      <p style="color:var(--text-dim);margin-bottom:16px;font-size:14px">Each pouch is a variable ‚Äî click to reveal what's stored inside!</p>
      <div class="backpack-zone" id="backpack">
        <div class="pouch" onclick="openPouch(this,'name','&quot;Luna&quot;','üëß')">
          <div class="pouch-label">name</div>
          <div class="pouch-icon">‚ùì</div>
          <div class="pouch-value">"Luna"</div>
        </div>
        <div class="pouch" onclick="openPouch(this,'age','10','üî¢')">
          <div class="pouch-label">age</div>
          <div class="pouch-icon">‚ùì</div>
          <div class="pouch-value">10</div>
        </div>
        <div class="pouch" onclick="openPouch(this,'snack','&quot;cookies&quot;','üç™')">
          <div class="pouch-label">snack</div>
          <div class="pouch-icon">‚ùì</div>
          <div class="pouch-value">"cookies"</div>
        </div>
        <div class="pouch" onclick="openPouch(this,'has_map','True','üó∫Ô∏è')">
          <div class="pouch-label">has_map</div>
          <div class="pouch-icon">‚ùì</div>
          <div class="pouch-value">True</div>
        </div>
        <div class="pouch" onclick="openPouch(this,'coins','3.5','üí∞')">
          <div class="pouch-label">coins</div>
          <div class="pouch-icon">‚ùì</div>
          <div class="pouch-value">3.5</div>
        </div>
      </div>
      <div class="var-output" id="var-output"></div>
    </div>

    <div class="fun-fact">
      <div class="ff-icon">üí°</div>
      <div>
        <div class="ff-title">Fun Fact!</div>
        <div class="ff-text">Variable names in Python can't start with a number! <code>1name</code> won't work, but <code>name1</code> will. Also, Python is <strong>case-sensitive</strong> ‚Äî <code>Name</code> and <code>name</code> are different variables!</div>
      </div>
    </div>

    <div class="story-nav">
      <button class="nav-arrow disabled">‚Üê Previous</button>
      <div class="nav-progress">
        <div class="nav-dot active" onclick="openStory(0)"></div>
        <div class="nav-dot" onclick="openStory(1)"></div>
        <div class="nav-dot" onclick="openStory(2)"></div>
        <div class="nav-dot" onclick="openStory(3)"></div>
        <div class="nav-dot" onclick="openStory(4)"></div>
      </div>
      <button class="nav-arrow" onclick="openStory(1)">Next Story ‚Üí</button>
    </div>
  </div>

  <!-- STORY 2: THE DRAGON'S RIDDLE -->
  <div class="story-view" id="story-1">
    <button class="back-btn" onclick="goHome()">‚Üê Back to Stories</button>
    <div class="story-header">
      <div class="story-chapter">Chapter 2</div>
      <h2 class="story-title" style="color:var(--red)">The Dragon's Riddle üî•</h2>
      <div class="character-badge" style="background:rgba(239,68,68,.1);color:var(--red)">üêâ Meet the Friendly Dragon</div>
      <div class="story-concept" style="background:rgba(239,68,68,.1);color:var(--red)">Python Concept: If / Else</div>
    </div>

    <img class="story-infographic" src="images/ifelse-dragons-riddle.jpg" alt="If/Else - The Dragon's Riddle Infographic" onclick="openLightbox(this.src)">

    <div class="story-narration">
      <p>Deep in the mountains, Luna found a <span class="highlight">glowing cave</span> guarded by a big, friendly dragon! üèîÔ∏è</p>
      <p style="margin-top:12px">The dragon said: <em>"To enter my cave, you must answer my riddle!"</em></p>
      <p style="margin-top:12px">In Python, we use <span class="code-inline">if</span>, <span class="code-inline">elif</span>, and <span class="code-inline">else</span> to check conditions ‚Äî just like the dragon checks answers!</p>
    </div>

    <div class="code-scroll">
      <pre><span class="cm"># The dragon checks your answer!</span>
<span class="fn">password</span> <span class="op">=</span> <span class="bi">input</span>(<span class="str">"What's the magic word? "</span>)

<span class="kw">if</span> <span class="fn">password</span> <span class="op">==</span> <span class="str">"friendship"</span>:
    <span class="bi">print</span>(<span class="str">"‚ú® The door opens! Welcome, friend!"</span>)
<span class="kw">elif</span> <span class="fn">password</span> <span class="op">==</span> <span class="str">"friend"</span>:
    <span class="bi">print</span>(<span class="str">"ü§î So close! Almost the right word..."</span>)
<span class="kw">else</span>:
    <span class="bi">print</span>(<span class="str">"‚ùå That's not it. Try again!"</span>)</pre>
    </div>

    <div class="interactive-section">
      <h3><span class="emoji">üêâ</span> The Dragon's Riddle</h3>
      <div class="dragon-scene">
        <div class="dragon-speech" id="dragon-speech">
          üêâ "What is the magic word to enter my cave? Choose wisely, young adventurer!"
        </div>
        <div class="choice-buttons" id="riddle-choices">
          <button class="choice-btn" onclick="answerRiddle(this,'fire')">üî• "fire"</button>
          <button class="choice-btn" onclick="answerRiddle(this,'friend')">ü§ù "friend"</button>
          <button class="choice-btn" onclick="answerRiddle(this,'friendship')">üíõ "friendship"</button>
          <button class="choice-btn" onclick="answerRiddle(this,'magic')">‚ú® "magic"</button>
        </div>
        <div class="riddle-result" id="riddle-result"></div>
      </div>
    </div>

    <div class="fun-fact">
      <div class="ff-icon">üí°</div>
      <div>
        <div class="ff-title">Fun Fact!</div>
        <div class="ff-text">In Python, <code>==</code> means "is equal to?" (a question), while <code>=</code> means "set this to" (a command). The dragon <em>asks</em> with <code>==</code> but Luna <em>stores</em> with <code>=</code>!</div>
      </div>
    </div>

    <div class="story-nav">
      <button class="nav-arrow" onclick="openStory(0)">‚Üê Previous</button>
      <div class="nav-progress">
        <div class="nav-dot" onclick="openStory(0)"></div>
        <div class="nav-dot active" onclick="openStory(1)"></div>
        <div class="nav-dot" onclick="openStory(2)"></div>
        <div class="nav-dot" onclick="openStory(3)"></div>
        <div class="nav-dot" onclick="openStory(4)"></div>
      </div>
      <button class="nav-arrow" onclick="openStory(2)">Next Story ‚Üí</button>
    </div>
  </div>

  <!-- STORY 3: THE WIZARD'S SPELL -->
  <div class="story-view" id="story-2">
    <button class="back-btn" onclick="goHome()">‚Üê Back to Stories</button>
    <div class="story-header">
      <div class="story-chapter">Chapter 3</div>
      <h2 class="story-title" style="color:var(--cyan)">The Wizard's Spell üåü</h2>
      <div class="character-badge" style="background:rgba(6,182,212,.1);color:var(--cyan)">üßô Meet Kai, the Young Wizard</div>
      <div class="story-concept" style="background:rgba(6,182,212,.1);color:var(--cyan)">Python Concept: Loops</div>
    </div>

    <img class="story-infographic" src="images/loops-wizards-spell.jpg" alt="Loops - The Wizard's Spell Infographic" onclick="openLightbox(this.src)">

    <div class="story-narration">
      <p>Young wizard <span class="highlight">Kai</span> stood under the night sky. His teacher said: <em>"To light the stars, you must cast a repeating spell!"</em> üåô</p>
      <p style="margin-top:12px">A <span class="code-inline">for</span> loop repeats something a set number of times. A <span class="code-inline">while</span> loop repeats as long as a condition is true!</p>
    </div>

    <div class="code-scroll">
      <pre><span class="cm"># Kai's star-lighting spell (for loop)</span>
<span class="kw">for</span> <span class="fn">star</span> <span class="kw">in</span> <span class="bi">range</span>(<span class="num">5</span>):
    <span class="bi">print</span>(<span class="str">f"‚≠ê Star </span><span class="op">{</span><span class="fn">star</span><span class="op">}</span><span class="str"> is glowing!"</span>)

<span class="cm"># Kai's dragon battle (while loop)</span>
<span class="fn">dragons</span> <span class="op">=</span> <span class="num">3</span>
<span class="kw">while</span> <span class="fn">dragons</span> <span class="op">></span> <span class="num">0</span>:
    <span class="bi">print</span>(<span class="str">f"üêâ Fighting dragon! </span><span class="op">{</span><span class="fn">dragons</span><span class="op">}</span><span class="str"> left"</span>)
    <span class="fn">dragons</span> <span class="op">-=</span> <span class="num">1</span></pre>
    </div>

    <div class="interactive-section">
      <h3><span class="emoji">‚≠ê</span> Cast the Star Spell! (for loop)</h3>
      <p style="color:var(--text-dim);margin-bottom:16px;font-size:14px">Watch Kai light stars one by one using <code>for star in range(5)</code></p>
      <div class="stars-grid" id="stars-grid">
        <div class="spell-star" id="star-0">‚≠ê</div>
        <div class="spell-star" id="star-1">‚≠ê</div>
        <div class="spell-star" id="star-2">‚≠ê</div>
        <div class="spell-star" id="star-3">‚≠ê</div>
        <div class="spell-star" id="star-4">‚≠ê</div>
      </div>
      <div class="loop-counter" id="loop-counter">Ready to cast!</div>
      <div class="spell-controls">
        <button class="btn btn-primary" onclick="castStarSpell()">ü™Ñ Cast Star Spell</button>
        <button class="btn btn-outline" onclick="resetStars()">üîÑ Reset</button>
      </div>
      <div class="spell-log" id="star-log"></div>
    </div>

    <div class="interactive-section">
      <h3><span class="emoji">üêâ</span> Dragon Battle! (while loop)</h3>
      <p style="color:var(--text-dim);margin-bottom:16px;font-size:14px">Watch Kai fight dragons using <code>while dragons > 0</code></p>
      <div class="stars-grid" id="dragons-grid">
        <div class="spell-star" id="dragon-0">üêâ</div>
        <div class="spell-star" id="dragon-1">üêâ</div>
        <div class="spell-star" id="dragon-2">üêâ</div>
      </div>
      <div class="loop-counter" id="dragon-counter">dragons = 3</div>
      <div class="spell-controls">
        <button class="btn btn-primary" onclick="fightDragons()">‚öîÔ∏è Fight Dragons</button>
        <button class="btn btn-outline" onclick="resetDragons()">üîÑ Reset</button>
      </div>
      <div class="spell-log" id="dragon-log"></div>
    </div>

    <div class="fun-fact">
      <div class="ff-icon">üí°</div>
      <div>
        <div class="ff-title">Fun Fact!</div>
        <div class="ff-text"><code>range(5)</code> gives you numbers 0, 1, 2, 3, 4 ‚Äî that's 5 numbers but starting from 0! You can also use <code>break</code> to stop a loop early and <code>continue</code> to skip one round!</div>
      </div>
    </div>

    <div class="story-nav">
      <button class="nav-arrow" onclick="openStory(1)">‚Üê Previous</button>
      <div class="nav-progress">
        <div class="nav-dot" onclick="openStory(0)"></div>
        <div class="nav-dot" onclick="openStory(1)"></div>
        <div class="nav-dot active" onclick="openStory(2)"></div>
        <div class="nav-dot" onclick="openStory(3)"></div>
        <div class="nav-dot" onclick="openStory(4)"></div>
      </div>
      <button class="nav-arrow" onclick="openStory(3)">Next Story ‚Üí</button>
    </div>
  </div>

  <!-- STORY 4: THE RECIPE BOOK -->
  <div class="story-view" id="story-3">
    <button class="back-btn" onclick="goHome()">‚Üê Back to Stories</button>
    <div class="story-header">
      <div class="story-chapter">Chapter 4</div>
      <h2 class="story-title" style="color:var(--green)">The Recipe Book üß™</h2>
      <div class="character-badge" style="background:rgba(16,185,129,.1);color:var(--green)">üë©‚Äçüç≥ Meet Maya, the Magical Chef</div>
      <div class="story-concept" style="background:rgba(16,185,129,.1);color:var(--green)">Python Concept: Functions</div>
    </div>

    <img class="story-infographic" src="images/functions-recipe-book.jpg" alt="Functions - The Recipe Book Infographic" onclick="openLightbox(this.src)">

    <div class="story-narration">
      <p>Chef <span class="highlight">Maya</span> has a magical kitchen! Her recipe book contains special recipes called <strong>functions</strong>. üç≥</p>
      <p style="margin-top:12px">Each recipe needs <em>ingredients</em> ‚Äî in Python, we call these <span class="code-inline">parameters</span>. The recipe produces a dish ‚Äî that's the <span class="code-inline">return value</span>!</p>
    </div>

    <div class="code-scroll">
      <pre><span class="cm"># Maya's magical recipe (a function!)</span>
<span class="kw">def</span> <span class="fn">make_potion</span>(<span class="fn">ingredient</span>):
    <span class="fn">potion</span> <span class="op">=</span> <span class="str">"magical "</span> <span class="op">+</span> <span class="fn">ingredient</span> <span class="op">+</span> <span class="str">" potion"</span>
    <span class="kw">return</span> <span class="fn">potion</span>

<span class="cm"># Call the function with different ingredients!</span>
<span class="fn">drink1</span> <span class="op">=</span> <span class="fn">make_potion</span>(<span class="str">"starlight"</span>)
<span class="fn">drink2</span> <span class="op">=</span> <span class="fn">make_potion</span>(<span class="str">"moonbeam"</span>)</pre>
    </div>

    <div class="interactive-section">
      <h3><span class="emoji">üß™</span> Maya's Potion Lab!</h3>
      <p style="color:var(--text-dim);margin-bottom:16px;font-size:14px">Pick an ingredient to put into the <code>make_potion()</code> function:</p>
      <div class="ingredient-shelf" id="ingredients">
        <div class="ingredient" onclick="selectIngredient(this,'üåü starlight')">üåü starlight</div>
        <div class="ingredient" onclick="selectIngredient(this,'üåô moonbeam')">üåô moonbeam</div>
        <div class="ingredient" onclick="selectIngredient(this,'üî• dragonfire')">üî• dragonfire</div>
        <div class="ingredient" onclick="selectIngredient(this,'‚ùÑÔ∏è frost')">‚ùÑÔ∏è frost</div>
        <div class="ingredient" onclick="selectIngredient(this,'üå∏ blossom')">üå∏ blossom</div>
        <div class="ingredient" onclick="selectIngredient(this,'‚ö° thunder')">‚ö° thunder</div>
      </div>
      <div class="cauldron" id="cauldron">üß™</div>
      <div style="text-align:center">
        <button class="btn btn-gold" onclick="brewPotion()">ü™Ñ Brew Potion!</button>
      </div>
      <div class="recipe-result" id="recipe-result"></div>
      <div class="recipe-code-live" id="recipe-live">
        <span class="cm"># Pick an ingredient above...</span><br>
        <span>make_potion( ? )</span>
      </div>
    </div>

    <div class="fun-fact">
      <div class="ff-icon">üí°</div>
      <div>
        <div class="ff-title">Fun Fact!</div>
        <div class="ff-text">Functions are like recipes you can use over and over! Python has built-in functions like <code>print()</code>, <code>len()</code>, and <code>input()</code>. When you write your own, use <code>def</code> (short for "define") to name your recipe!</div>
      </div>
    </div>

    <div class="story-nav">
      <button class="nav-arrow" onclick="openStory(2)">‚Üê Previous</button>
      <div class="nav-progress">
        <div class="nav-dot" onclick="openStory(0)"></div>
        <div class="nav-dot" onclick="openStory(1)"></div>
        <div class="nav-dot" onclick="openStory(2)"></div>
        <div class="nav-dot active" onclick="openStory(3)"></div>
        <div class="nav-dot" onclick="openStory(4)"></div>
      </div>
      <button class="nav-arrow" onclick="openStory(4)">Next Story ‚Üí</button>
    </div>
  </div>

  <!-- STORY 5: THE MAGICAL TOY BOX -->
  <div class="story-view" id="story-4">
    <button class="back-btn" onclick="goHome()">‚Üê Back to Stories</button>
    <div class="story-header">
      <div class="story-chapter">Chapter 5</div>
      <h2 class="story-title" style="color:var(--pink)">The Magical Toy Box üéÅ</h2>
      <div class="character-badge" style="background:rgba(236,72,153,.1);color:var(--pink)">üß∏ Meet Zara and Her Toy Collection</div>
      <div class="story-concept" style="background:rgba(236,72,153,.1);color:var(--pink)">Python Concept: Lists</div>
    </div>

    <img class="story-infographic" src="images/lists-toy-box.jpg" alt="Lists - The Magical Toy Box Infographic" onclick="openLightbox(this.src)">

    <div class="story-narration">
      <p><span class="highlight">Zara</span> received a magical toy box for her birthday! üéÇ</p>
      <p style="margin-top:12px">The toy box has <strong>numbered slots</strong> starting from 0. She can put toys in, take them out, count them, and find them by number!</p>
      <p style="margin-top:12px">In Python, a <span class="code-inline">list</span> works just like this. It stores multiple items in order, and you can access them by their <strong>index</strong> (slot number)!</p>
    </div>

    <div class="code-scroll">
      <pre><span class="cm"># Zara's toy box (a list!)</span>
<span class="fn">toys</span> <span class="op">=</span> [<span class="str">"üß∏ teddy"</span>, <span class="str">"ü§ñ robot"</span>, <span class="str">"üêâ dragon"</span>]

<span class="cm"># Access by index (slot number)</span>
<span class="bi">print</span>(<span class="fn">toys</span>[<span class="num">0</span>])       <span class="cm"># üß∏ teddy (first!)</span>
<span class="bi">print</span>(<span class="fn">toys</span>[<span class="num">-1</span>])      <span class="cm"># üêâ dragon (last!)</span>

<span class="cm"># Add and remove toys</span>
<span class="fn">toys</span>.<span class="fn">append</span>(<span class="str">"ü¶Ñ unicorn"</span>)
<span class="fn">toys</span>.<span class="fn">remove</span>(<span class="str">"ü§ñ robot"</span>)
<span class="bi">print</span>(<span class="bi">len</span>(<span class="fn">toys</span>))    <span class="cm"># 3 toys!</span></pre>
    </div>

    <div class="interactive-section">
      <h3><span class="emoji">üéÅ</span> Zara's Toy Box!</h3>
      <div class="toy-list-display" id="toy-list-code">toys = ["üß∏ teddy", "ü§ñ robot", "üêâ dragon"]</div>
      <div class="toybox" id="toybox"></div>
      <div class="toy-controls">
        <input type="text" class="toy-input" id="toy-input" placeholder="Toy name..." list="toy-suggestions">
        <datalist id="toy-suggestions">
          <option value="ü¶Ñ unicorn">
          <option value="üöÄ rocket">
          <option value="üé∏ guitar">
          <option value="üß© puzzle">
          <option value="‚öΩ ball">
        </datalist>
        <button class="btn btn-primary btn-sm" onclick="addToy()">append()</button>
        <button class="btn btn-outline btn-sm" onclick="removeToy()">remove()</button>
        <button class="btn btn-outline btn-sm" onclick="popToy()">pop()</button>
      </div>
      <div class="toy-controls">
        <input type="number" class="toy-input" id="toy-index" placeholder="Index..." min="0" style="width:100px">
        <button class="btn btn-outline btn-sm" onclick="getToy()">toys[i]</button>
        <button class="btn btn-outline btn-sm" onclick="toyLen()">len()</button>
        <button class="btn btn-outline btn-sm" onclick="resetToys()">üîÑ Reset</button>
      </div>
      <div class="toy-output" id="toy-output"></div>
    </div>

    <div class="fun-fact">
      <div class="ff-icon">üí°</div>
      <div>
        <div class="ff-title">Fun Fact!</div>
        <div class="ff-text">Lists start counting at 0, not 1! So the first toy is <code>toys[0]</code>. You can also use negative numbers: <code>toys[-1]</code> gives the LAST item! It's like counting backwards. üîÑ</div>
      </div>
    </div>

    <div class="story-nav">
      <button class="nav-arrow" onclick="openStory(3)">‚Üê Previous</button>
      <div class="nav-progress">
        <div class="nav-dot" onclick="openStory(0)"></div>
        <div class="nav-dot" onclick="openStory(1)"></div>
        <div class="nav-dot" onclick="openStory(2)"></div>
        <div class="nav-dot" onclick="openStory(3)"></div>
        <div class="nav-dot active" onclick="openStory(4)"></div>
      </div>
      <button class="nav-arrow disabled">Next Story ‚Üí</button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="site-footer">
    <p>Made with üíú for young coders everywhere</p>
    <p style="margin-top:8px">Part of <a href="https://rathishkumarlearning.github.io/course-hub/" target="_blank">Rathish's Learning Hub</a> ‚Ä¢ Free & Open Source</p>
  </footer>

</div>

<script>
// ========================================
// STATE
// ========================================
let currentView = 'home'; // 'home' or story index
let toyList = ['üß∏ teddy', 'ü§ñ robot', 'üêâ dragon'];
let selectedIngredient = null;
let starSpellRunning = false;
let dragonFightRunning = false;

// ========================================
// THREE.JS SUBTLE BACKGROUND
// ========================================
(function initThree() {
  const canvas = document.getElementById('three-canvas');
  const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
  camera.position.z = 30;

  // Stars
  const starsGeo = new THREE.BufferGeometry();
  const starsCount = 500;
  const positions = new Float32Array(starsCount * 3);
  const colors = new Float32Array(starsCount * 3);
  for (let i = 0; i < starsCount; i++) {
    positions[i * 3] = (Math.random() - 0.5) * 80;
    positions[i * 3 + 1] = (Math.random() - 0.5) * 80;
    positions[i * 3 + 2] = (Math.random() - 0.5) * 50;
    const c = new THREE.Color();
    c.setHSL(0.6 + Math.random() * 0.3, 0.5, 0.7 + Math.random() * 0.3);
    colors[i * 3] = c.r; colors[i * 3 + 1] = c.g; colors[i * 3 + 2] = c.b;
  }
  starsGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  starsGeo.setAttribute('color', new THREE.BufferAttribute(colors, 3));
  const starsMat = new THREE.PointsMaterial({ size: 1.2, vertexColors: true, transparent: true, opacity: 0.5, sizeAttenuation: true });
  const stars = new THREE.Points(starsGeo, starsMat);
  scene.add(stars);

  // Sparkle particles
  const sparkleGeo = new THREE.BufferGeometry();
  const sparkleCount = 60;
  const sparklePos = new Float32Array(sparkleCount * 3);
  const sparkleVel = [];
  for (let i = 0; i < sparkleCount; i++) {
    sparklePos[i * 3] = (Math.random() - 0.5) * 60;
    sparklePos[i * 3 + 1] = (Math.random() - 0.5) * 60;
    sparklePos[i * 3 + 2] = (Math.random() - 0.5) * 30;
    sparkleVel.push({ y: Math.random() * 0.02 + 0.005 });
  }
  sparkleGeo.setAttribute('position', new THREE.BufferAttribute(sparklePos, 3));
  const sparkleMat = new THREE.PointsMaterial({ color: 0xfbbf24, size: 0.8, transparent: true, opacity: 0.35 });
  scene.add(new THREE.Points(sparkleGeo, sparkleMat));

  let time = 0;
  function animate() {
    requestAnimationFrame(animate);
    time += 0.008;
    stars.rotation.y = time * 0.015;
    stars.rotation.x = Math.sin(time * 0.08) * 0.015;

    const sPos = sparkleGeo.attributes.position.array;
    for (let i = 0; i < sparkleCount; i++) {
      sPos[i * 3 + 1] += sparkleVel[i].y;
      if (sPos[i * 3 + 1] > 30) { sPos[i * 3 + 1] = -30; sPos[i * 3] = (Math.random() - 0.5) * 60; }
    }
    sparkleGeo.attributes.position.needsUpdate = true;
    renderer.render(scene, camera);
  }
  animate();

  window.addEventListener('resize', () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
})();

// ========================================
// NAVIGATION
// ========================================
function goHome() {
  document.getElementById('homepage').style.display = 'block';
  document.querySelectorAll('.story-view').forEach(v => v.classList.remove('active'));
  currentView = 'home';
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function openStory(index) {
  document.getElementById('homepage').style.display = 'none';
  document.querySelectorAll('.story-view').forEach(v => v.classList.remove('active'));
  document.getElementById(`story-${index}`).classList.add('active');
  currentView = index;
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ========================================
// LIGHTBOX
// ========================================
function openLightbox(src) {
  document.getElementById('lightbox-img').src = src;
  document.getElementById('lightbox').classList.add('active');
  document.body.style.overflow = 'hidden';
}
function closeLightbox() {
  document.getElementById('lightbox').classList.remove('active');
  document.body.style.overflow = '';
}
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeLightbox();
});

// ========================================
// STORY 1: MAGIC BACKPACK
// ========================================
function openPouch(el, name, value, emoji) {
  if (el.classList.contains('open')) return;
  el.classList.add('open');
  el.querySelector('.pouch-icon').textContent = emoji;
  document.getElementById('var-output').innerHTML = `<span style="color:var(--purple)">${name}</span> = <span style="color:var(--green)">${value}</span> ‚ú®`;
}

// ========================================
// STORY 2: DRAGON'S RIDDLE
// ========================================
function answerRiddle(btn, answer) {
  const result = document.getElementById('riddle-result');
  document.querySelectorAll('#riddle-choices .choice-btn').forEach(b => b.classList.remove('correct', 'wrong', 'almost'));
  if (answer === 'friendship') {
    btn.classList.add('correct');
    result.innerHTML = '‚úÖ <strong>if password == "friendship":</strong> ‚ú® The cave door opens! "Welcome, friend!" üêâüíõ';
    result.style.background = 'rgba(16,185,129,.1)'; result.style.color = 'var(--green)';
  } else if (answer === 'friend') {
    btn.classList.add('almost');
    result.innerHTML = 'ü§î <strong>elif password == "friend":</strong> "So close! The magic word is longer..."';
    result.style.background = 'rgba(249,115,22,.1)'; result.style.color = 'var(--orange)';
  } else {
    btn.classList.add('wrong');
    result.innerHTML = '‚ùå <strong>else:</strong> "Nope! Think about what makes friends special..." üêâ';
    result.style.background = 'rgba(239,68,68,.1)'; result.style.color = 'var(--red)';
  }
  result.classList.add('show');
}

// ========================================
// STORY 3: WIZARD'S SPELL
// ========================================
function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

async function castStarSpell() {
  if (starSpellRunning) return;
  starSpellRunning = true;
  resetStars();
  const log = document.getElementById('star-log');
  const counter = document.getElementById('loop-counter');
  for (let i = 0; i < 5; i++) {
    await sleep(500);
    document.getElementById(`star-${i}`).classList.add('lit');
    counter.innerHTML = `for star in range(5): <span style="color:var(--cyan)">star = ${i}</span>`;
    log.innerHTML += `<div class="log-line"><span class="log-iter">star = ${i}</span> ‚Üí <span class="log-action">‚≠ê Star ${i} is glowing!</span></div>`;
    log.scrollTop = log.scrollHeight;
  }
  counter.innerHTML = 'üéâ Loop complete! All 5 stars are lit!';
  starSpellRunning = false;
}

function resetStars() {
  for (let i = 0; i < 5; i++) document.getElementById(`star-${i}`).classList.remove('lit');
  document.getElementById('star-log').innerHTML = '';
  document.getElementById('loop-counter').textContent = 'Ready to cast!';
}

async function fightDragons() {
  if (dragonFightRunning) return;
  dragonFightRunning = true;
  resetDragons();
  const log = document.getElementById('dragon-log');
  const counter = document.getElementById('dragon-counter');
  let dragons = 3;
  for (let i = 0; i < 3; i++) document.getElementById(`dragon-${i}`).classList.add('lit');
  await sleep(400);
  while (dragons > 0) {
    await sleep(700);
    dragons--;
    document.getElementById(`dragon-${2 - dragons}`).classList.remove('lit');
    counter.innerHTML = `while dragons > 0: <span style="color:var(--cyan)">dragons = ${dragons}</span>`;
    log.innerHTML += `<div class="log-line"><span class="log-iter">dragons = ${dragons + 1} ‚Üí ${dragons}</span> ‚Üí <span class="log-action">‚öîÔ∏è Dragon defeated!</span></div>`;
    log.scrollTop = log.scrollHeight;
  }
  counter.innerHTML = 'üéâ All dragons defeated! while loop ended.';
  dragonFightRunning = false;
}

function resetDragons() {
  for (let i = 0; i < 3; i++) document.getElementById(`dragon-${i}`).classList.remove('lit');
  document.getElementById('dragon-log').innerHTML = '';
  document.getElementById('dragon-counter').textContent = 'dragons = 3';
}

// ========================================
// STORY 4: RECIPE BOOK
// ========================================
function selectIngredient(el, name) {
  document.querySelectorAll('.ingredient').forEach(i => i.classList.remove('selected'));
  el.classList.add('selected');
  selectedIngredient = name;
  const cleanName = name.split(' ')[1];
  document.getElementById('recipe-live').innerHTML = `<span class="kw">def</span> <span class="fn">make_potion</span>(<span class="fn">ingredient</span>):\n    potion = "magical " + ingredient + " potion"\n    <span class="kw">return</span> potion\n\n<span class="active-line">result = make_potion("${cleanName}")  # ‚Üê calling!</span>`;
}

function brewPotion() {
  if (!selectedIngredient) {
    document.getElementById('recipe-result').innerHTML = 'üëÜ Pick an ingredient first!';
    document.getElementById('recipe-result').style.color = 'var(--text-dim)';
    return;
  }
  const cauldron = document.getElementById('cauldron');
  const cleanName = selectedIngredient.split(' ')[1];
  const emoji = selectedIngredient.split(' ')[0];
  cauldron.classList.add('brewing');
  cauldron.textContent = emoji;
  setTimeout(() => {
    cauldron.classList.remove('brewing');
    cauldron.textContent = '‚ú®';
    document.getElementById('recipe-result').innerHTML = `${emoji} <strong>Magical ${cleanName} potion</strong> brewed! ‚Üí return "magical ${cleanName} potion"`;
    document.getElementById('recipe-result').style.color = 'var(--gold)';
  }, 1000);
}

// ========================================
// STORY 5: TOY BOX
// ========================================
function renderToyBox() {
  const box = document.getElementById('toybox');
  const display = document.getElementById('toy-list-code');
  if (toyList.length === 0) {
    box.innerHTML = '<span style="color:var(--text-dim)">Empty toy box! Add some toys.</span>';
  } else {
    box.innerHTML = toyList.map((t, i) => `<div class="toy-slot" onclick="highlightToy(${i})"><div class="toy-emoji">${t.split(' ')[0]}</div><div class="toy-index">[${i}]</div></div>`).join('');
  }
  display.textContent = `toys = [${toyList.map(t => `"${t}"`).join(', ')}]`;
}

function highlightToy(i) {
  document.getElementById('toy-output').innerHTML = `toys[<span style="color:var(--purple)">${i}</span>] = "<span style="color:var(--green)">${toyList[i]}</span>"`;
}

function addToy() {
  const input = document.getElementById('toy-input');
  const val = input.value.trim();
  if (!val) return;
  toyList.push(val);
  input.value = '';
  renderToyBox();
  document.getElementById('toy-output').innerHTML = `toys.append("<span style="color:var(--green)">${val}</span>") ‚Üí len = ${toyList.length}`;
}

function removeToy() {
  const input = document.getElementById('toy-input');
  const val = input.value.trim();
  if (!val) { document.getElementById('toy-output').innerHTML = 'Type a toy name to remove!'; return; }
  const idx = toyList.indexOf(val);
  if (idx === -1) { document.getElementById('toy-output').innerHTML = `‚ùå "${val}" not found!`; return; }
  toyList.splice(idx, 1);
  input.value = '';
  renderToyBox();
  document.getElementById('toy-output').innerHTML = `toys.remove("<span style="color:var(--red)">${val}</span>") ‚Üí len = ${toyList.length}`;
}

function popToy() {
  if (toyList.length === 0) { document.getElementById('toy-output').innerHTML = '‚ùå Toy box is empty!'; return; }
  const popped = toyList.pop();
  renderToyBox();
  document.getElementById('toy-output').innerHTML = `toys.pop() ‚Üí removed "<span style="color:var(--red)">${popped}</span>"`;
}

function getToy() {
  const idx = parseInt(document.getElementById('toy-index').value);
  if (isNaN(idx)) { document.getElementById('toy-output').innerHTML = 'Enter an index number!'; return; }
  if (idx < 0 || idx >= toyList.length) { document.getElementById('toy-output').innerHTML = `‚ùå IndexError! Valid: 0-${toyList.length - 1}`; return; }
  document.getElementById('toy-output').innerHTML = `toys[<span style="color:var(--purple)">${idx}</span>] = "<span style="color:var(--green)">${toyList[idx]}</span>"`;
}

function toyLen() {
  document.getElementById('toy-output').innerHTML = `len(toys) = <span style="color:var(--cyan)">${toyList.length}</span>`;
}

function resetToys() {
  toyList = ['üß∏ teddy', 'ü§ñ robot', 'üêâ dragon'];
  renderToyBox();
  document.getElementById('toy-output').innerHTML = 'Toy box reset! üîÑ';
}

// ========================================
// SPARKLE CURSOR
// ========================================
document.addEventListener('click', (e) => {
  const sparkles = ['‚ú®', '‚≠ê', 'üí´'];
  for (let i = 0; i < 2; i++) {
    const s = document.createElement('div');
    s.className = 'sparkle';
    s.textContent = sparkles[Math.floor(Math.random() * sparkles.length)];
    s.style.left = (e.clientX + (Math.random() - 0.5) * 30) + 'px';
    s.style.top = (e.clientY + (Math.random() - 0.5) * 30) + 'px';
    document.body.appendChild(s);
    setTimeout(() => s.remove(), 1000);
  }
});

// ========================================
// KEYBOARD NAV
// ========================================
document.addEventListener('keydown', (e) => {
  if (typeof currentView === 'number') {
    if (e.key === 'ArrowLeft' && currentView > 0) openStory(currentView - 1);
    if (e.key === 'ArrowRight' && currentView < 4) openStory(currentView + 1);
  }
});

// ========================================
// INIT
// ========================================
renderToyBox();

window.addEventListener('load', () => {
  setTimeout(() => document.getElementById('loader').classList.add('hidden'), 1200);
});
</script>
</body>
</html>
